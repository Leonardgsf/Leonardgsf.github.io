<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://leonardgsf.github.io/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://leonardgsf.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-WebRTC" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/04/16/WebRTC/" class="article-date">
  <time class="dt-published" datetime="2024-04-16T00:15:22.000Z" itemprop="datePublished">2024-04-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="WebRTC-1对1实时音视频直播-Blog"><a href="#WebRTC-1对1实时音视频直播-Blog" class="headerlink" title="WebRTC 1对1实时音视频直播 Blog"></a>WebRTC 1对1实时音视频直播 Blog</h1><p>💡 设想一个情景：相隔两地的A和B，想进行音视频通信。应该怎么实现？</p>
<p>当然，对于现在的人们来说，我们有很多的手段，包括常见的即时通信工具（QQ、微信）、腾讯会议、钉钉等，都可以轻松实现这个功能。</p>
<p>那如果现在让你从零手动搭建一套远程一对一的音视频通信系统，应该怎么实现呢？</p>
<p>不知道你脑海中有没有实现的思路。如果对这一领域比较陌生的同学，暂时莫慌，在下边的文章中我们会逐步拆解及介绍整个实现流程。希望学完这一课程，你会有一个比较清晰的脉络和学到可行的实践方案。</p>
<p>话不多说，Let’s go！ 让我们开始今天的远程通信旅程吧~</p>
<h2 id="背景概要"><a href="#背景概要" class="headerlink" title="背景概要"></a>背景概要</h2><ul>
<li>2011 年，Google 创立了 WebRTC 项目，其愿景就是可以在浏览器之间快速地实现音视频通信。</li>
<li>WebRTC实现了基于网页的视频会议，标准是WHATWG 协议，目的是通过浏览器提供简单的javascript就可以达到实时通讯（Real-Time Communications (RTC)）能力。</li>
<li>WebRTC提供了视频会议的核心技术，包括音视频的采集、编解码、网络传输、显示等功能，并且还支持跨平台：windows，linux，mac，android。</li>
<li>我们前期使用时知道基本的API就行，如果想继续了解，可以参照以下webrtc官方文档。</li>
</ul>
<h2 id="步骤拆解"><a href="#步骤拆解" class="headerlink" title="步骤拆解"></a>步骤拆解</h2><ol>
<li>既然通信的内容是音视频，肯定需要A、B各自的终端来检测、采集本地的音视频信息。</li>
<li>采集完毕之后，A、B需要知道对方是否在线，确认对方已经准备好接收和传输音视频数据了。</li>
<li>A、B双方需要沟通连接的信息及协议，方便建立通路。协商音视频编解码的格式，方便后续音视频渲染和播放。</li>
<li>接下来就是最重要的点对点连接环节了，WebRTC提供的RTCPeerConnection会帮我们搞定一切。</li>
<li>连接建立后，A、B的音视频数据在这条连接通路上要以直接方式各自不间断地传输到另一端。</li>
<li>如果这个连接通路断掉的话，如何保障数据能稳定到达另一端呢？所以我们还要有一个中继服务器辅助双方完成音视频数据的中继及交换。</li>
<li>最后音视频传输过来之后，要在各自客户端内进行解码、渲染、播放。</li>
</ol>
<p>个人理解，实现整个流程就是把各个细分的环节跑通，最后将所有环节自然串联运转起来的流程。接下来，让我们渗透到每一个环节中去分析解决方案。</p>
<h3 id="获取本地音视频信息"><a href="#获取本地音视频信息" class="headerlink" title="获取本地音视频信息"></a>获取本地音视频信息</h3><ul>
<li>音视频采集基本概念<ul>
<li><strong>摄像头</strong>。用于捕捉（采集）图像和视频。</li>
<li><strong>帧率</strong>。现在的摄像头功能已非常强大，一般情况下，一秒钟可以采集 30 张以上的图像，一些好的摄像头甚至可以采集 100 张以上。我们把<strong>摄像头一秒钟采集图像的次数称为帧率</strong>。帧率越高，视频就越平滑流畅。然而，在直播系统中一般不会设置太高的帧率，因为帧率越高，占的网络带宽就越多。</li>
<li><strong>分辨率</strong>。摄像头除了可以设置帧率之外，还可以调整分辨率。我们常见的分辨率有 2K、1080P、720P、420P 等。分辨率越高图像就越清晰，但同时也带来一个问题，即占用的带宽也就越多。所以，在直播系统中，分辨率的高低与网络带宽有紧密的联系。也就是说，分辨率会跟据你的网络带宽进行动态调整。</li>
<li><strong>宽高比</strong>。分辨率一般分为两种宽高比，即 16:9 或 4:3。4:3 的宽高比是从黑白电视而来，而 16:9 的宽高比是从显示器而来。现在一般情况下都采用 16:9 的比例。</li>
<li><strong>麦克风</strong>。用于采集音频数据。它与视频一样，可以指定一秒内采样的次数，称为<strong>采样率</strong>。每个采样用几个 bit 表示，称为<strong>采样位深或采样大小</strong>。</li>
<li><strong>轨（Track）</strong>。WebRTC 中的“轨”借鉴了多媒体的概念。火车轨道的特性你应该非常清楚，两条轨永远不会相交。“轨”在多媒体中表达的就是<strong>每条轨数据都是独立的，不会与其他轨相交</strong>，如 MP4 中的音频轨、视频轨，它们在 MP4 文件中是被分别存储的。</li>
<li><strong>流（Stream）</strong>。可以理解为容器。在 WebRTC 中，“流”可以分为媒体流（MediaStream）和数据流（DataStream）。其中，媒体流可以存放 0 个或多个音频轨或视频轨；数据流可以存 0 个或多个数据轨。</li>
</ul>
</li>
<li>音视频采集API<ul>
<li><p>WebRTC提供了简单清晰的API来访问和采集本地音频设备或屏幕，具体使用如下</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//默认采集音频、视频</span></span><br><span class="line"><span class="keyword">const</span> constraints = &#123;</span><br><span class="line">    <span class="string">&#x27;video&#x27;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&#x27;audio&#x27;</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//定制化采集参数</span></span><br><span class="line">    <span class="keyword">const</span> constraints = &#123;</span><br><span class="line">        <span class="string">&#x27;audio&#x27;</span>: &#123;<span class="string">&#x27;echoCancellation&#x27;</span>: <span class="literal">true</span>&#125;,</span><br><span class="line">        <span class="string">&#x27;video&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;frameRate&#x27;</span>: <span class="number">15</span>, <span class="comment">//帧率</span></span><br><span class="line">            <span class="string">&#x27;width&#x27;</span>: &#123;<span class="string">&#x27;min&#x27;</span>: <span class="number">640</span>&#125;, <span class="comment">//采集视频最小宽度</span></span><br><span class="line">            <span class="string">&#x27;height&#x27;</span>: &#123;<span class="string">&#x27;min&#x27;</span>: <span class="number">480</span>&#125; <span class="comment">//采集视频最小高度</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//采集用户音视频</span></span><br><span class="line">navigator.<span class="property">mediaDevices</span>.<span class="title function_">getUserMedia</span>(constraints)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">stream</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Got MediaStream:&#x27;</span>, stream);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error accessing media devices.&#x27;</span>, error);</span><br><span class="line">    &#125;);</span><br><span class="line"><span class="comment">//采集用户屏幕流</span></span><br><span class="line">navigator.<span class="property">mediaDevices</span>.<span class="title function_">getDisplayMedia</span>(constraints)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">stream</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Got MediaStream:&#x27;</span>, stream);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error accessing media devices.&#x27;</span>, error);</span><br><span class="line"> &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li><p>getUserMedia&#x2F;getDisplayMedia会触发一个浏览器对用户本地音视频设备的权限请求。</p>
<ul>
<li>若用户接受，则会根据constraints设置的video和audio配置，来采集对应的音频轨、视频轨。</li>
<li>若用户拒绝，则会抛出NotAllowed异常，一旦没有发现可用的设备，则会抛出NotFoundError异常。</li>
</ul>
</li>
<li><p>具体API细节可参考如下链接</p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices">MediaDevices - Web APIs | MDN</a></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="信令交换"><a href="#信令交换" class="headerlink" title="信令交换"></a>信令交换</h3><p>在线状态、媒体信息、连接信息等，（通过部署信令服务器完成，后文会展开介绍）</p>
<ul>
<li><p>实现房间管理，加入房间、退出房间、发送其他消息等，方便客户端互相明确在线状态。</p>
</li>
<li><p>交换媒体协商数据（音视频编码协议等）</p>
</li>
<li><p>交换ICE「Interactive Connectivity Establishment」 Candidate，包含连接协议、IP、端口等</p>
<p>ICE Candidate （ICE 候选者）。它表示 WebRTC 与远端通信时使用的协议、IP 地址和端口，一般由以下字段组成：本地 IP 地址本地端口号候选者类型，包括 host、srflx 和 relay优先级传输协议访问服务的用户名……</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  IP: xxx.xxx.xxx.xxx,</span><br><span class="line">  port: number,</span><br><span class="line">  <span class="built_in">type</span>: host/srflx/relay,</span><br><span class="line">  priority: number,</span><br><span class="line">  protocol: UDP/TCP,</span><br><span class="line">  usernameFragment: string</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="点对点连接"><a href="#点对点连接" class="headerlink" title="点对点连接"></a>点对点连接</h3><p>通信的双方都需要新建一个RTCPeerConnection对象，实现点对点的P2P连接。RTCPeerConnection对象主要实现以下功能：</p>
<ul>
<li><p>承载本地及远端音视频等数据流，通过点对点或者中继的形式发送数据，同时绑定了相应的回调函数，当有远端的数据流到来时，提醒业务层进行后续渲染操作</p>
</li>
<li><p>自动获取媒体描述信息SDP，同时存储通过信令服务器交换获取到的远端SDP信息。</p>
</li>
<li><p>收集ICE（Interactive Connectivity Establishment） Candidate。同时存储通过信令服务器交换获取到的远端 ICE Candidate信息，以便进行端与端之间的连接</p>
<ul>
<li>host 类型，即本机内网的 IP 和端口；最容易手机的Candidate</li>
<li>srflx 类型, 通过STUN协议实现，即本机 NAT 映射后的外网的 IP 和端口；通过在外网搭建一个 STUN 服务器，通过发数据包的方式获取自己外网IP和端口<ul>
<li>relay 类型，即中继服务器的 IP 和端口；通过向 TURN 服务器发送 Allocation 指令，relay 服务就会在服务器端分配一个新的 relay 端口，用于两端中转 UDP 数据报。</li>
</ul>
</li>
</ul>
</li>
<li><p>NAT穿越建立连接，WebRTC底层都帮我们实现了，这里不展开介绍了，有兴趣的小伙伴可以参考以下文档</p>
<p><a target="_blank" rel="noopener" href="https://blog.jianchihu.net/webrtc-av-transport-basis-nat-traversal.html">WebRTC音视频传输基础：NAT穿透</a></p>
</li>
</ul>
<h3 id="数据中转"><a href="#数据中转" class="headerlink" title="数据中转"></a>数据中转</h3><p>点对点连接失败的数据中转（通过TURN服务器实现）</p>
<ul>
<li>在P2P连接失败时，提供数据中继服务时</li>
<li>在ICE交换的过程中，协助客户端获取自己的外网IP和端口</li>
</ul>
<p>以上就是我们远程通信的关键步骤，下图就是这个完整的流程呈现。图片来源于极客时间李超老师的课程<a target="_blank" rel="noopener" href="https://time.geekbang.org/column/intro/100031801">《从0打造音视频直播系统》</a></p>
<p><img src="/img/geek_webrtc.png" alt="一对一音视频通信架构-极客时间"></p>
<p>上图是整个 WebRTC 1 对 1 音视频实时通话的过程图。通过这幅图，你可以看出要实现 1 对 1 音视频实时通话其过程还是蛮复杂的。</p>
<p>这幅图从大的方面可以分为 4 部分，即<strong>两个 WebRTC 终端</strong>（上图中的两个大方框）、<strong>一个 Signal（信令）服务器</strong>和<strong>一个 STUN&#x2F;TURN 服务器</strong>。</p>
<p>WebRTC 终端，负责音视频采集、编解码、NAT 穿越、音视频数据传输。</p>
<p>Signal 服务器，负责信令处理，如加入房间、离开房间、媒体协商消息的传递等。</p>
<p>STUN&#x2F;TURN 服务器，负责获取 WebRTC 终端在公网的 IP 地址，以及 NAT 穿越失败后的数据中转。</p>
<p>接下来我们依据上边的整体流程及理论指导，来进行具体的实现环节~</p>
<h2 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h2><h3 id="前置准备"><a href="#前置准备" class="headerlink" title="前置准备"></a>前置准备</h3><ul>
<li>2M带宽以上的云主机+域名+https证书<ul>
<li>不管是搭建信令和中继服务器、还是提供客户端在浏览器访问同一套通信代码，都需要一台云主机。</li>
<li>为何需要 2M 以上带宽的带宽呢？，对于一路 720P 的视频，一般情况下需要 1.2M 的带宽，因此在两人通信时，如果都走服务器中转的话就需要 2.4M 的带宽了。所以为了保证双方通信顺畅，带宽是必须要能跟得上的。</li>
<li>因为浏览器安全限制，访问音视频时，都需要相应的https证书，所以域名和https证书都是需要准备的。</li>
</ul>
</li>
</ul>
<h3 id="服务器环境部署"><a href="#服务器环境部署" class="headerlink" title="服务器环境部署"></a>服务器环境部署</h3><ul>
<li><p>web服务器搭建</p>
<ul>
<li><p>主要是给客户端(浏览器)提供执行的文件(html、css、js)，我们示例中用Node.js来实现，主要是考虑到后续信令服务依赖于Node.js。下边是代码示例，我们暂命名为server.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> https = <span class="built_in">require</span>(<span class="string">&#x27;https&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> serveIndex = <span class="built_in">require</span>(<span class="string">&#x27;serve-index&#x27;</span>);</span><br><span class="line">...</span><br><span class="line"><span class="comment">//使用express实现WEB服务</span></span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>(); </span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">serveIndex</span>(<span class="string">&#x27;./public&#x27;</span>));</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(<span class="string">&#x27;./public&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//HTTPS 证书和密钥文件</span></span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">  key : fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;./cert/yourrtc.cn.key&#x27;</span>),</span><br><span class="line">  <span class="attr">cert</span>: fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;./cert/yourrtc.cn.pem&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//https server</span></span><br><span class="line"><span class="keyword">var</span> https_server = https.<span class="title function_">createServer</span>(options, app);</span><br><span class="line"><span class="keyword">var</span> io = socketIo.<span class="title function_">listen</span>(https_server);</span><br><span class="line">https_server.<span class="title function_">listen</span>(<span class="number">443</span>, <span class="string">&#x27;0.0.0.0&#x27;</span>);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>​</p>
</li>
</ul>
</li>
<li><p>信令服务搭建</p>
<ul>
<li><p>我们同样使用Node.js来搭建信令服务器，代码可以放在上述的server.js中，只需添加socket的服务端部分即可</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">static</span> = <span class="built_in">require</span>(<span class="string">&#x27;node-static&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> file = <span class="title function_">new</span>(<span class="keyword">static</span>.<span class="property">Server</span>)();</span><br><span class="line"><span class="keyword">const</span> app = http.<span class="title function_">createServer</span>(<span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  file.<span class="title function_">serve</span>(req, res);</span><br><span class="line">&#125;).<span class="title function_">listen</span>(<span class="number">2013</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> io = <span class="built_in">require</span>(<span class="string">&#x27;socket.io&#x27;</span>).<span class="title function_">listen</span>(app); <span class="comment">//侦听 2013</span></span><br><span class="line"></span><br><span class="line">io.<span class="property">sockets</span>.<span class="title function_">on</span>(<span class="string">&#x27;connection&#x27;</span>, <span class="function">(<span class="params">socket</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// convenience function to log server messages to the client</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">log</span>(<span class="params"></span>)&#123; </span><br><span class="line">    <span class="keyword">const</span> array = [<span class="string">&#x27;&gt;&gt;&gt; Message from server: &#x27;</span>]; </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">arguments</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      array.<span class="title function_">push</span>(<span class="variable language_">arguments</span>[i]);</span><br><span class="line">    &#125; </span><br><span class="line">      socket.<span class="title function_">emit</span>(<span class="string">&#x27;log&#x27;</span>, array);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  socket.<span class="title function_">on</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params">message</span>) =&gt;</span> &#123; <span class="comment">//收到message时，进行广播</span></span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;Got message:&#x27;</span>, message);</span><br><span class="line">    <span class="comment">// for a real app, would be room only (not broadcast)</span></span><br><span class="line">    socket.<span class="property">broadcast</span>.<span class="title function_">emit</span>(<span class="string">&#x27;message&#x27;</span>, message); <span class="comment">//在真实的应用中，应该只在房间内广播</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  socket.<span class="title function_">on</span>(<span class="string">&#x27;create or join&#x27;</span>, <span class="function">(<span class="params">room</span>) =&gt;</span> &#123; <span class="comment">//收到 “create or join” 消息</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> clientsInRoom = io.<span class="property">sockets</span>.<span class="property">adapter</span>.<span class="property">rooms</span>[room];</span><br><span class="line">    <span class="keyword">var</span> numClients = clientsInRoom ? <span class="title class_">Object</span>.<span class="title function_">keys</span>(clientsInRoom.<span class="property">sockets</span>).<span class="property">length</span> : <span class="number">0</span>; <span class="comment">//房间里的人数</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;Room &#x27;</span> + room + <span class="string">&#x27; has &#x27;</span> + numClients + <span class="string">&#x27; client(s)&#x27;</span>);</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;Request to create or join room &#x27;</span> + room);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (numClients === <span class="number">0</span>)&#123; <span class="comment">//如果房间里没人</span></span><br><span class="line">      socket.<span class="title function_">join</span>(room);</span><br><span class="line">      socket.<span class="title function_">emit</span>(<span class="string">&#x27;created&#x27;</span>, room); <span class="comment">//发送 &quot;created&quot; 消息</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (numClients === <span class="number">1</span>) &#123; <span class="comment">//如果房间里有一个人</span></span><br><span class="line">    io.<span class="property">sockets</span>.<span class="title function_">in</span>(room).<span class="title function_">emit</span>(<span class="string">&#x27;join&#x27;</span>, room);</span><br><span class="line">      socket.<span class="title function_">join</span>(room);</span><br><span class="line">      socket.<span class="title function_">emit</span>(<span class="string">&#x27;joined&#x27;</span>, room); <span class="comment">//发送 “joined”消息</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// max two clients</span></span><br><span class="line">      socket.<span class="title function_">emit</span>(<span class="string">&#x27;full&#x27;</span>, room); <span class="comment">//发送 &quot;full&quot; 消息</span></span><br><span class="line">    &#125;</span><br><span class="line">    socket.<span class="title function_">emit</span>(<span class="string">&#x27;emit(): client &#x27;</span> + socket.<span class="property">id</span> +</span><br><span class="line">      <span class="string">&#x27; joined room &#x27;</span> + room);</span><br><span class="line">    socket.<span class="property">broadcast</span>.<span class="title function_">emit</span>(<span class="string">&#x27;broadcast(): client &#x27;</span> + socket.<span class="property">id</span> +</span><br><span class="line">      <span class="string">&#x27; joined room &#x27;</span> + room);</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>turn服务器搭建</p>
<ul>
<li>turn服务器主要是用来在点对点连接失败的时候，进行数据中继转发的。同时也可用于帮助客户端获取自己的外网IP地址和端口，协助客户端建立点对点的连接。</li>
<li>我们采用目前最著名的Turn服务器，由Google 发起的开源项目coturn，地址为<a target="_blank" rel="noopener" href="https://github.com/coturn/coturn">coturn</a>，</li>
<li>安装coturn<ul>
<li>从 <a target="_blank" rel="noopener" href="https://github.com/coturn/coturn">https://github.com/coturn/coturn</a> 下载 coturn 代码；</li>
<li>执行 .&#x2F;configure –prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;coturn 生成 Makefile；</li>
<li>执行 make 来编译 coturn；</li>
<li>执行 sudo make install 进行安装。</li>
</ul>
</li>
<li>配置coturn<ul>
<li><p>编辑coturn的配置文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/coturn/turnserver.conf</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改以下四项配置即可</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">user=use:pas #连接turn服务器的用户名和密码</span><br><span class="line">realm=yourrtc.cn #设置为你的访问域名</span><br><span class="line">listening-port=3478 #监听端口，固定为3478</span><br><span class="line">external-ip=1.2.3.55 #更换为你的公网IP</span><br></pre></td></tr></table></figure>

<p>​</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="客户端代码编写部署"><a href="#客户端代码编写部署" class="headerlink" title="客户端代码编写部署"></a>客户端代码编写部署</h3><ul>
<li>客户端使用信令服务,建立client.js文件</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isInitiator;</span><br><span class="line"></span><br><span class="line">room = <span class="title function_">prompt</span>(<span class="string">&#x27;Enter room name:&#x27;</span>); <span class="comment">//弹出一个输入窗口</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> socket = io.<span class="title function_">connect</span>(); <span class="comment">//与服务端建立socket连接</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (room !== <span class="string">&#x27;&#x27;</span>) &#123; <span class="comment">//如果房间不空，则发送 &quot;create or join&quot; 消息</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Joining room &#x27;</span> + room);</span><br><span class="line">  socket.<span class="title function_">emit</span>(<span class="string">&#x27;create or join&#x27;</span>, room);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//socket的message消息是主要的交换渠道，交换双方的媒体信息及连接信息</span></span><br><span class="line">socket.<span class="title function_">on</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params">roomid, data</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;receive message!&#x27;</span>, roomid, data);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(data === <span class="literal">null</span> || data === <span class="literal">undefined</span>)&#123;</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;the message is invalid!&#x27;</span>);</span><br><span class="line">		<span class="keyword">return</span>;	</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(data.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;type&#x27;</span>) &amp;&amp; data.<span class="property">type</span> === <span class="string">&#x27;offer&#x27;</span>) &#123;</span><br><span class="line">		</span><br><span class="line">		offer.<span class="property">value</span> = data.<span class="property">sdp</span>;</span><br><span class="line"></span><br><span class="line">		pc.<span class="title function_">setRemoteDescription</span>(<span class="keyword">new</span> <span class="title class_">RTCSessionDescription</span>(data));</span><br><span class="line"></span><br><span class="line">		<span class="comment">//create answer</span></span><br><span class="line">		pc.<span class="title function_">createAnswer</span>()</span><br><span class="line">			.<span class="title function_">then</span>(getAnswer)</span><br><span class="line">			.<span class="title function_">catch</span>(handleAnswerError);</span><br><span class="line"></span><br><span class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span>(data.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;type&#x27;</span>) &amp;&amp; data.<span class="property">type</span> == <span class="string">&#x27;answer&#x27;</span>)&#123;</span><br><span class="line">		answer.<span class="property">value</span> = data.<span class="property">sdp</span>;</span><br><span class="line">		pc.<span class="title function_">setRemoteDescription</span>(<span class="keyword">new</span> <span class="title class_">RTCSessionDescription</span>(data));</span><br><span class="line">	</span><br><span class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span> (data.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;type&#x27;</span>) &amp;&amp; data.<span class="property">type</span> === <span class="string">&#x27;candidate&#x27;</span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> candidate = <span class="keyword">new</span> <span class="title class_">RTCIceCandidate</span>(&#123;</span><br><span class="line">			<span class="attr">sdpMLineIndex</span>: data.<span class="property">label</span>,</span><br><span class="line">			<span class="attr">candidate</span>: data.<span class="property">candidate</span></span><br><span class="line">		&#125;);</span><br><span class="line">		pc.<span class="title function_">addIceCandidate</span>(candidate);	</span><br><span class="line">	</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;the message is invalid!&#x27;</span>, data);</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line">socket.<span class="title function_">on</span>(<span class="string">&#x27;join&#x27;</span>, <span class="function">(<span class="params">room</span>) =&gt;</span> &#123; <span class="comment">//如果从服务端收到 “join&quot; 消息</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Making request to join room &#x27;</span> + room);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;You are the initiator!&#x27;</span>);</span><br><span class="line">  <span class="comment">//根据信令服务的通知来建立相应的连接及绑定流，后续有示例</span></span><br><span class="line">  <span class="title function_">createPeerConnection</span>(); <span class="comment">//加入房间成功后，开始建立PeerConnection对象</span></span><br><span class="line">  <span class="title function_">bindTracks</span>(); <span class="comment">//绑定相应的流</span></span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">socket.<span class="title function_">on</span>(<span class="string">&#x27;log&#x27;</span>, <span class="function">(<span class="params">array</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="property">log</span>.<span class="title function_">apply</span>(<span class="variable language_">console</span>, array);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//定义客户端发送socket消息的方法</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sendMessage</span>(<span class="params">roomid, data</span>)&#123;</span><br><span class="line"></span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;send message to other end&#x27;</span>, roomid, data);</span><br><span class="line">	<span class="keyword">if</span>(!socket)&#123;</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;socket is null&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	socket.<span class="title function_">emit</span>(<span class="string">&#x27;message&#x27;</span>, roomid, data);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//填写本地的媒体信息，并通过信令服务发送到远端，适合当前客户端为初始发起者。</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getOffer</span>(<span class="params">desc</span>)&#123;</span><br><span class="line">	pc.<span class="title function_">setLocalDescription</span>(desc);</span><br><span class="line">	offer.<span class="property">value</span> = desc.<span class="property">sdp</span>;</span><br><span class="line">	offerdesc = desc;</span><br><span class="line">	<span class="comment">//send offer sdp</span></span><br><span class="line">	<span class="title function_">sendMessage</span>(roomid, offerdesc);	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//收到远端的媒体信息时，建立本客户端应答的媒体信息，并发送到远端，适合当前客户端为应答者</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getAnswer</span>(<span class="params">desc</span>)&#123;</span><br><span class="line">	pc.<span class="title function_">setLocalDescription</span>(desc);</span><br><span class="line">	answer.<span class="property">value</span> = desc.<span class="property">sdp</span>;</span><br><span class="line">	<span class="comment">//send answer sdp</span></span><br><span class="line">	<span class="title function_">sendMessage</span>(roomid, desc);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>客户端结合turn服务器，进行点对点的连接与流的传输，也在client.js编写</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义turn服务器的基础配置，与上文中coturn服务器的配置一致即可。</span></span><br><span class="line"><span class="keyword">var</span> pcConfig = &#123;</span><br><span class="line">  <span class="string">&#x27;iceServers&#x27;</span>: [&#123; <span class="comment">//指定 ICE 服务器信令</span></span><br><span class="line">    <span class="string">&#x27;urls&#x27;</span>: <span class="string">&#x27;turn:stun.al.learningrtc.cn:3478&#x27;</span>, <span class="comment">//turn服务器地址，需要加`turn:`的固定前缀</span></span><br><span class="line">    <span class="string">&#x27;credential&#x27;</span>: <span class="string">&quot;passwd&quot;</span>, <span class="comment">//turn服务器密码，你要用自己的 </span></span><br><span class="line">    <span class="string">&#x27;username&#x27;</span>: <span class="string">&quot;username&quot;</span>  <span class="comment">//turn服务器用户名，你要用自己的</span></span><br><span class="line">  &#125;]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//建立RTCPeerConnection对象，注册收到数据流的回调事件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createPeerConnection</span>(<span class="params"></span>)&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span>(!pc)&#123;</span><br><span class="line">    pc = <span class="keyword">new</span> <span class="title class_">RTCPeerConnection</span>(pcConfig); <span class="comment">//创建peerconnection对象</span></span><br><span class="line">    ...</span><br><span class="line">    pc.<span class="property">ontrack</span> = getRemoteStream; <span class="comment">//当远端的track到来时会触发该事件</span></span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;the pc have be created!&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//当远程音视频流数据传输完成的时候，进行渲染播放操作</span></span><br><span class="line"><span class="keyword">var</span> remoteVideo = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;video#remotevideo&#x27;</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getRemoteStream</span>(<span class="params">e</span>)&#123;  <span class="comment">//事件处理函数</span></span><br><span class="line">  remoteStream = e.<span class="property">streams</span>[<span class="number">0</span>]; <span class="comment">//保存远端的流</span></span><br><span class="line">  remoteVideo.<span class="property">srcObject</span> = e.<span class="property">streams</span>[<span class="number">0</span>]; <span class="comment">//与HTML中的视频标签绑定</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//把本地的媒体流添加到RTCPeerConnection对象里边，供后续远程传输</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bindTracks</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">//add all track into peer connection</span></span><br><span class="line">  localStream.<span class="title function_">getTracks</span>().<span class="title function_">forEach</span>(<span class="function">(<span class="params">track</span>)=&gt;</span>&#123;</span><br><span class="line">    pc.<span class="title function_">addTrack</span>(track, localStream); <span class="comment">//将track与peerconnection绑定</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>再添加一些静态代码，方便渲染和预览本地及远端的音视频</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;connserver&quot;</span>&gt;</span>Connect Sig Server<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;start&quot;</span> <span class="attr">disabled</span>&gt;</span>Start<span class="tag">&lt;/<span class="name">button</span>&gt;</span>	</span><br><span class="line">	<span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;call&quot;</span> <span class="attr">disabled</span>&gt;</span>Call<span class="tag">&lt;/<span class="name">button</span>&gt;</span>	</span><br><span class="line">	<span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;hangup&quot;</span> <span class="attr">disabled</span>&gt;</span>HangUp<span class="tag">&lt;/<span class="name">button</span>&gt;</span>	</span><br><span class="line">	<span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;leave&quot;</span> <span class="attr">disabled</span>&gt;</span>Leave<span class="tag">&lt;/<span class="name">button</span>&gt;</span>	</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;shareDesk&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;shareDesk&quot;</span>&gt;</span>Share Desktop<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;preview&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">width</span>=<span class="string">&quot;40%&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">h2</span>&gt;</span>Local:<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">video</span> <span class="attr">id</span>=<span class="string">&quot;localvideo&quot;</span> <span class="attr">autoplay</span> <span class="attr">playsinline</span> <span class="attr">muted</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">h2</span>&gt;</span>Offer SDP:<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">&quot;offer&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">width</span>=<span class="string">&quot;40%&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">h2</span>&gt;</span>Remote:<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">video</span> <span class="attr">id</span>=<span class="string">&quot;remotevideo&quot;</span> <span class="attr">autoplay</span> <span class="attr">playsinline</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">h2</span>&gt;</span>Answer SDP:<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">&quot;answer&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Chat:<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">&quot;chat&quot;</span> <span class="attr">disabled</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">&quot;sendtxt&quot;</span> <span class="attr">disabled</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;send&quot;</span> <span class="attr">disabled</span>&gt;</span>Send<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以上就是浏览器端实现 1 对 1 实时通话的整体逻辑。在本文中，我们引入了WebRTC这项技术，并逐步拆解了通信的基本步骤和要素，最后再把整体的运行环境和通信模块展开介绍。</p>
<p>不得不说，涉及到的技术和术语知识还是很多的，鉴于能力和篇幅有限，此篇文章无法深入到众多的知识点，比如NAT穿越等。如果你对音视频通信感兴趣的话，希望这篇博客能帮助你理清思路，帮你入门。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://time.geekbang.org/column/intro/100031801?tab=catalog">极客时间-李超老师-从 0 打造音视频直播系统</a></p>
<p><a target="_blank" rel="noopener" href="https://webrtc.org/getting-started/overview">Getting started with WebRTC</a></p>
<p><a target="_blank" rel="noopener" href="https://webrtc.github.io/webrtc-org/start/">WebRTC进阶</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/avdance/webrtc_web">WebRTC-demo</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://leonardgsf.github.io/2024/04/16/WebRTC/" data-id="clv28v1sr0000whs69f9ca26v" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-article-title" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/28/article-title/" class="article-date">
  <time class="dt-published" datetime="2023-07-28T07:09:03.000Z" itemprop="datePublished">2023-07-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/28/article-title/">Hammerspoon  一款Mac上提升你工作学习效率的神器</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="什么是Hammerspoon？"><a href="#什么是Hammerspoon？" class="headerlink" title="什么是Hammerspoon？"></a>什么是Hammerspoon？</h2><p>Hammerspoon是一款针对macOS的自动化工具。其核心与本质是在lua脚本引擎与操作系统之间的桥梁和通道，赋予用户极大的能力和自由度去调用系统功能，最大化地发挥系统功能，提升我们的学习和工作效率。</p>
<p>至于lua的语法，对于稍微有编程基础的同学来说都很好理解。以下是一个lua的快速学习参考链接，可以参考，在此就不展开介绍了。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://learnxinyminutes.com/docs/lua/">Lua语言快速入门</a></li>
</ul>
<h2 id="Hammerspoon可以帮我做什么？"><a href="#Hammerspoon可以帮我做什么？" class="headerlink" title="Hammerspoon可以帮我做什么？"></a>Hammerspoon可以帮我做什么？</h2><p>顾名思义，Hammerspoon翻译过来为锤子勺子，既能帮你干一些体力活，也能辅助你完成一些日常精细的工作。</p>
<p>你可以编写简单的lua代码与macOS系统进行充分交互。控制和操作MacOS系统的应用软件、窗口、输入法、鼠标、文件系统、声音设备、屏幕、剪贴板、wifi等等。</p>
<p>我来依照我自身的日常使用场景来举几个例子。</p>
<ul>
<li><p><code>一键唤起各个特定应用</code></p>
<p>   我们工作或学习时可能经常会打开多个软件，并在这几个应软件进行频繁切换。当然，Mac下用触摸板或者Cmd+Tab可以实现方便切换。打开2-3个软件时原生的方法可能会很方便，但如果你打开5个应用以上时，你部分时间可能就得消耗在一直分辨、挑选真正想打开的软件。</p>
<p>  而使用Hammerspoon你可以定义一系列的快捷键，来轻松唤起特定的应用，实现即想即达。</p>
<p>  比如我用 <code>Cmd+Ctrl+w</code> 可以轻松唤出微信，<code>Cmd+Ctrl+c</code>打开Chrome，<code>Cmd+Ctrl+d</code>打开钉钉，<code>Cmd+Ctrl+t打开终端iTerm2</code>等等。</p>
</li>
<li><p><code>多软件下的输入法个性化配置</code></p>
<p>  一般我们会打开微信、钉钉用中文进行消息发送，但切换到终端时我们需要用英文进行命令行或者编程。Hammerspoon可以支持我们对特定的应用进行对应输入法的配置。比如我配置微信、钉钉无论何时打开都是中文，同时终端一般默认用英文输入法。</p>
</li>
<li><p><code>多屏下窗口快速移动和鼠标焦点切换及窗口布局</code></p>
<ul>
<li>鼠标焦点和光标切换<ul>
<li>在编程或者查看资料的时候，需要经常在多个屏幕中切换。所以我借助Hammerspoon配置了多个屏幕下切换光标焦点的快捷键。</li>
</ul>
</li>
<li>软件窗口在多个屏幕间快速移动<ul>
<li>在演示功能用例或者预览资料的时候，大屏预览会比较舒服和方便。快捷键可实现快速移动，并且自动最大化，无需你重新调整窗口布局。</li>
</ul>
</li>
<li>同屏幕多软件窗口布局。<ul>
<li>支持同屏幕打开多个窗口，并进行各种比例的布局。常见的是左右布局及上下布局。</li>
</ul>
</li>
</ul>
</li>
<li><p><code>自定义快捷键，查看当前天气、公历农历时间。</code></p>
<ul>
<li>有时候我们在沉浸式地全屏时，想看天气或者很多资料，Hammerspoon支持我们调用系统展示层，进行相应的信息展示，非常方便。如下所示。</li>
</ul>
<p>  <img src="/img/hammer_time.png" alt="img"></p>
</li>
</ul>
<h2 id="如何安装Hammerspoon？"><a href="#如何安装Hammerspoon？" class="headerlink" title="如何安装Hammerspoon？"></a>如何安装Hammerspoon？</h2><p>点击<a target="_blank" rel="noopener" href="https://github.com/Hammerspoon/hammerspoon/releases/tag/0.9.100">Hammerspoon下载</a>，解压之后，直接拖到应用软件目录下即可完成安装。</p>
<h2 id="如何配置及应用Hammerspoon？"><a href="#如何配置及应用Hammerspoon？" class="headerlink" title="如何配置及应用Hammerspoon？"></a>如何配置及应用Hammerspoon？</h2><ul>
<li><p>新建Hammerspoon配置目录</p>
<p>  Hammerspoon需要在如下目录下自定义创建配置文件 <code>~/.hammerspoon/init.lua</code> ，如果没有<code>.hammerspoon</code>目录，则需要新建。</p>
</li>
</ul>
<p>目录结构介绍</p>
<p><code>~/.hammerspoon</code> —— 配置文件主目录</p>
<ul>
<li>init.lua —— 配置总入口，加载相关配置文件</li>
<li>modules —— 各模块目录<ul>
<li>hotkey.lua  —— 组合快捷键定义</li>
<li>inputsources.lua —— 应用软件输入法实现</li>
<li>windows.lua —— 窗口布局、移动、聚焦等实现</li>
</ul>
</li>
</ul>
<p>安装及基本配置目录创建完成后，就可以进行编写代码实现你的个性化需求了。</p>
<ul>
<li>各配置文件配置<ul>
<li><strong>首先是入口文件init.lua</strong>，可参照如下配置。入口文件中引用其他配置文件，同时我配置了重新加载配置的功能，方便修改配置文件后即时生效。</li>
</ul>
</li>
</ul>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Reload config automatically</span></span><br><span class="line"><span class="keyword">local</span> configFileWatcher</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reloadConfig</span><span class="params">()</span></span></span><br><span class="line">  configFileWatcher:stop()</span><br><span class="line">  configFileWatcher = <span class="literal">nil</span></span><br><span class="line">  hs.reload()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">configFileWatcher = hs.pathwatcher.new(<span class="built_in">os</span>.<span class="built_in">getenv</span>(<span class="string">&quot;HOME&quot;</span>) .. <span class="string">&quot;/.hammerspoon/&quot;</span>, reloadConfig)</span><br><span class="line">configFileWatcher:start()</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Load local modules</span></span><br><span class="line"><span class="built_in">require</span> <span class="string">&quot;modules/hotkey&quot;</span> <span class="comment">-- hotkey.lua</span></span><br><span class="line"><span class="built_in">require</span> <span class="string">&quot;modules/windows&quot;</span> <span class="comment">-- windows.lua</span></span><br><span class="line"><span class="built_in">require</span> <span class="string">&quot;modules/inputsource&quot;</span> <span class="comment">-- inputsource.lua</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Load Spoons</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Finally, show a notification that we finished loading the config</span></span><br><span class="line">hs.notify.new( &#123;title=<span class="string">&#x27;Hammerspoon&#x27;</span>, subTitle=<span class="string">&#x27;Configuration loaded&#x27;</span>&#125; ):send()</span><br></pre></td></tr></table></figure>


<pre><code>- 组合快捷键定义modules目录下的hotkey.lua
</code></pre>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hyper = &#123;<span class="string">&quot;cmd&quot;</span>, <span class="string">&quot;ctrl&quot;</span>, <span class="string">&quot;alt&quot;</span>&#125;</span><br><span class="line">hyperShift = &#123;<span class="string">&quot;alt&quot;</span>, <span class="string">&quot;shift&quot;</span>&#125;</span><br><span class="line">hyperCtrl = &#123;<span class="string">&quot;alt&quot;</span>, <span class="string">&quot;ctrl&quot;</span>&#125;</span><br><span class="line">hyperAlt = &#123;<span class="string">&quot;ctrl&quot;</span>, <span class="string">&quot;alt&quot;</span>, <span class="string">&quot;shift&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<pre><code>- 然后是modules目录下的inputsource.lua文件，为各应用设置对应的输入法
</code></pre>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> application = <span class="built_in">require</span> <span class="string">&quot;hs.application&quot;</span></span><br><span class="line"><span class="keyword">local</span> hotkey = <span class="built_in">require</span> <span class="string">&quot;hs.hotkey&quot;</span></span><br><span class="line"><span class="keyword">local</span> window = <span class="built_in">require</span> <span class="string">&quot;hs.window&quot;</span></span><br><span class="line"><span class="keyword">local</span> alert = <span class="built_in">require</span> <span class="string">&quot;hs.alert&quot;</span></span><br><span class="line"><span class="keyword">local</span> keycodes = <span class="built_in">require</span> <span class="string">&quot;hs.keycodes&quot;</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">Chinese</span><span class="params">()</span></span></span><br><span class="line">    <span class="comment">-- 简体拼音</span></span><br><span class="line">    keycodes.currentSourceID(<span class="string">&quot;com.sogou.inputmethod.sogou.pinyin&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">English</span><span class="params">()</span></span></span><br><span class="line">    <span class="comment">-- ABC</span></span><br><span class="line">    keycodes.currentSourceID(<span class="string">&quot;com.apple.keylayout.ABC&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- app to expected ime config</span></span><br><span class="line"><span class="comment">-- app和对应的输入法</span></span><br><span class="line"><span class="keyword">local</span> app2Ime = &#123;</span><br><span class="line">    &#123;<span class="string">&#x27;/Applications/iTerm.app&#x27;</span>, <span class="string">&#x27;English&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;/System/Library/CoreServices/Finder.app&#x27;</span>, <span class="string">&#x27;English&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;/Applications/System Preferences.app&#x27;</span>, <span class="string">&#x27;English&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;/Applications/DingTalk.app&#x27;</span>, <span class="string">&#x27;Chinese&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;/Applications/WeChat.app&#x27;</span>, <span class="string">&#x27;Chinese&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;/Applications/Notion.app&#x27;</span>, <span class="string">&#x27;Chinese&#x27;</span>&#125;,</span><br><span class="line">    <span class="comment">-- &#123;&#x27;/Applications/Google Chrome.app&#x27;, &#x27;English&#x27;&#125;,</span></span><br><span class="line">    <span class="comment">-- &#123;&#x27;/Applications/Kindle.app&#x27;, &#x27;English&#x27;&#125;,</span></span><br><span class="line">    <span class="comment">-- &#123;&#x27;/Applications/Visual Studio Code.app&#x27;, &#x27;English&#x27;&#125;,</span></span><br><span class="line">    <span class="comment">-- &#123;&#x27;/Applications/Xcode.app&#x27;, &#x27;English&#x27;&#125;,</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateFocusAppInputMethod</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">local</span> ime = <span class="string">&#x27;English&#x27;</span></span><br><span class="line">    <span class="keyword">local</span> focusAppPath = window.frontmostWindow():application():<span class="built_in">path</span>()</span><br><span class="line">    <span class="comment">-- alert.show(&quot;path:  &quot;..focusAppPath )</span></span><br><span class="line">    <span class="keyword">for</span> index, app <span class="keyword">in</span> <span class="built_in">pairs</span>(app2Ime) <span class="keyword">do</span></span><br><span class="line">        <span class="comment">-- alert.show(&quot;app:  &quot;..app[1])</span></span><br><span class="line">        <span class="comment">-- alert.show(&quot;im:  &quot;..app[2])</span></span><br><span class="line">        <span class="keyword">local</span> appPath = app[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">local</span> expectedIme = app[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> focusAppPath == appPath <span class="keyword">then</span></span><br><span class="line">            ime = expectedIme</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ime == <span class="string">&#x27;English&#x27;</span> <span class="keyword">then</span></span><br><span class="line">        English()</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        Chinese()</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- helper hotkey to figure out the app path and name of current focused window</span></span><br><span class="line"><span class="comment">-- 当选中某窗口按下ctrl+command+m时会显示应用的路径等信息</span></span><br><span class="line">hotkey.bind(&#123;<span class="string">&#x27;ctrl&#x27;</span>, <span class="string">&#x27;cmd&#x27;</span>&#125;, <span class="string">&quot;m&quot;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">    alert.show(<span class="string">&quot;App path is:        &quot;</span></span><br><span class="line">    ..window.focusedWindow():application():<span class="built_in">path</span>()</span><br><span class="line">    ..<span class="string">&quot;\n&quot;</span></span><br><span class="line">    ..<span class="string">&quot;App name:      &quot;</span></span><br><span class="line">    ..window.focusedWindow():application():name()</span><br><span class="line">    ..<span class="string">&quot;\n&quot;</span></span><br><span class="line">    ..<span class="string">&quot;IM source id:  &quot;</span></span><br><span class="line">    ..keycodes.currentSourceID())</span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Handle cursor focus and application&#x27;s screen manage.</span></span><br><span class="line"><span class="comment">-- 窗口激活时自动切换输入法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">applicationWatcher</span><span class="params">(appName, eventType, appObject)</span></span></span><br><span class="line">    <span class="keyword">if</span> (eventType == application.watcher.activated <span class="keyword">or</span> eventType == application.watcher.launched) <span class="keyword">then</span></span><br><span class="line">        updateFocusAppInputMethod()</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">appWatcher = application.watcher.new(applicationWatcher)</span><br><span class="line">appWatcher:start()</span><br></pre></td></tr></table></figure>

<pre><code>   - 最后是modules目录下的windows.lua文件，进行窗口、屏幕、鼠标的控制。
</code></pre>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- window management</span></span><br><span class="line"><span class="keyword">local</span> application = <span class="built_in">require</span> <span class="string">&quot;hs.application&quot;</span></span><br><span class="line"><span class="keyword">local</span> hotkey = <span class="built_in">require</span> <span class="string">&quot;hs.hotkey&quot;</span></span><br><span class="line"><span class="keyword">local</span> window = <span class="built_in">require</span> <span class="string">&quot;hs.window&quot;</span></span><br><span class="line"><span class="keyword">local</span> layout = <span class="built_in">require</span> <span class="string">&quot;hs.layout&quot;</span></span><br><span class="line"><span class="keyword">local</span> grid = <span class="built_in">require</span> <span class="string">&quot;hs.grid&quot;</span></span><br><span class="line"><span class="keyword">local</span> hints = <span class="built_in">require</span> <span class="string">&quot;hs.hints&quot;</span></span><br><span class="line"><span class="keyword">local</span> screen = <span class="built_in">require</span> <span class="string">&quot;hs.screen&quot;</span></span><br><span class="line"><span class="keyword">local</span> alert = <span class="built_in">require</span> <span class="string">&quot;hs.alert&quot;</span></span><br><span class="line"><span class="keyword">local</span> fnutils = <span class="built_in">require</span> <span class="string">&quot;hs.fnutils&quot;</span></span><br><span class="line"><span class="keyword">local</span> geometry = <span class="built_in">require</span> <span class="string">&quot;hs.geometry&quot;</span></span><br><span class="line"><span class="keyword">local</span> mouse = <span class="built_in">require</span> <span class="string">&quot;hs.mouse&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- default 0.2</span></span><br><span class="line">window.animationDuration = <span class="number">0</span></span><br><span class="line"><span class="comment">-- alert.defaultStyle[&#x27;fadeOutDuration&#x27;] = 0.05</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toggle_full</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">local</span> win = window.focusedWindow()</span><br><span class="line">    <span class="keyword">if</span> win:isFullScreen() <span class="keyword">then</span></span><br><span class="line">        win:toggleFullScreen()</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- left half</span></span><br><span class="line">hotkey.bind(hyperCtrl, <span class="string">&quot;h&quot;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">  <span class="keyword">if</span> window.focusedWindow() <span class="keyword">then</span></span><br><span class="line">    window.focusedWindow():moveToUnit(layout.left50)</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    alert.show(<span class="string">&quot;No active window&quot;</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- right half</span></span><br><span class="line">hotkey.bind(hyperCtrl, <span class="string">&quot;l&quot;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">  toggle_full()</span><br><span class="line">  window.focusedWindow():moveToUnit(layout.right50)</span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- top half</span></span><br><span class="line">hotkey.bind(hyperCtrl, <span class="string">&quot;k&quot;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">  toggle_full()</span><br><span class="line">  window.focusedWindow():moveToUnit<span class="string">&#x27;[0,0,100,50]&#x27;</span></span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- bottom half</span></span><br><span class="line">hotkey.bind(hyperCtrl, <span class="string">&quot;j&quot;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">  toggle_full()</span><br><span class="line">  window.focusedWindow():moveToUnit<span class="string">&#x27;[0,50,100,100]&#x27;</span></span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- full screen</span></span><br><span class="line">hotkey.bind(hyperCtrl, <span class="string">&#x27;;&#x27;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span> </span><br><span class="line">  window.focusedWindow():toggleFullScreen()</span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- center window</span></span><br><span class="line">hotkey.bind(hyperCtrl, <span class="string">&#x27;c&#x27;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span> </span><br><span class="line">  toggle_full()</span><br><span class="line">  window.focusedWindow():centerOnScreen()</span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- maximize window</span></span><br><span class="line">hotkey.bind(hyperCtrl, <span class="string">&#x27;m&#x27;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">  toggle_full()</span><br><span class="line">  toggle_maximize()</span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- defines for window maximize toggler</span></span><br><span class="line"><span class="keyword">local</span> frameCache = &#123;&#125;</span><br><span class="line"><span class="comment">-- toggle a window between its normal size, and being maximized</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toggle_maximize</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">local</span> win = window.focusedWindow()</span><br><span class="line">    win:maximize()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- move active window to previous monitor</span></span><br><span class="line">hotkey.bind(hyper, <span class="string">&quot;h&quot;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">  window.focusedWindow():moveOneScreenWest()</span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- move active window to next monitor</span></span><br><span class="line">hotkey.bind(hyper, <span class="string">&quot;l&quot;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">  window.focusedWindow():moveOneScreenEast()</span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- open application using shortcut</span></span><br><span class="line">hotkey.bind(&#123;<span class="string">&#x27;ctrl&#x27;</span>, <span class="string">&#x27;cmd&#x27;</span>&#125;, <span class="string">&quot;c&quot;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">  application.<span class="built_in">open</span>(<span class="string">&#x27;Google Chrome.app&#x27;</span>)</span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line">hotkey.bind(&#123;<span class="string">&#x27;ctrl&#x27;</span>, <span class="string">&#x27;cmd&#x27;</span>&#125;, <span class="string">&quot;e&quot;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">  application.<span class="built_in">open</span>(<span class="string">&#x27;Microsoft Edge.app&#x27;</span>)</span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line">hotkey.bind(&#123;<span class="string">&#x27;ctrl&#x27;</span>, <span class="string">&#x27;cmd&#x27;</span>&#125;, <span class="string">&quot;t&quot;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">  application.<span class="built_in">open</span>(<span class="string">&#x27;iTerm.app&#x27;</span>)</span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line">hotkey.bind(&#123;<span class="string">&#x27;ctrl&#x27;</span>, <span class="string">&#x27;cmd&#x27;</span>&#125;, <span class="string">&quot;w&quot;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">  application.<span class="built_in">open</span>(<span class="string">&#x27;WeChat.app&#x27;</span>)</span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line">hotkey.bind(&#123;<span class="string">&#x27;ctrl&#x27;</span>, <span class="string">&#x27;cmd&#x27;</span>&#125;, <span class="string">&quot;d&quot;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">  application.<span class="built_in">open</span>(<span class="string">&#x27;DingTalk.app&#x27;</span>)</span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line">hotkey.bind(&#123;<span class="string">&#x27;ctrl&#x27;</span>, <span class="string">&#x27;cmd&#x27;</span>&#125;, <span class="string">&quot;n&quot;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">  application.<span class="built_in">open</span>(<span class="string">&#x27;Notion.app&#x27;</span>)</span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line"><span class="comment">-- open Desktop Folder</span></span><br><span class="line">hotkey.bind(&#123;<span class="string">&#x27;ctrl&#x27;</span>, <span class="string">&#x27;cmd&#x27;</span>&#125;, <span class="string">&quot;f&quot;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">  hs.<span class="built_in">execute</span>(<span class="string">&#x27;open /Users/Feng/Desktop/&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--Predicate that checks if a window belongs to a screen</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isInScreen</span><span class="params">(screen, win)</span></span></span><br><span class="line">  <span class="keyword">return</span> win:screen() == screen</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">focusScreen</span><span class="params">(screen)</span></span></span><br><span class="line">  <span class="comment">--Get windows within screen, ordered from front to back.</span></span><br><span class="line">  <span class="comment">--If no windows exist, bring focus to desktop. Otherwise, set focus on</span></span><br><span class="line">  <span class="comment">--front-most application window.</span></span><br><span class="line">  <span class="keyword">local</span> windows = fnutils.filter(</span><br><span class="line">      window.orderedWindows(),</span><br><span class="line">      fnutils.partial(isInScreen, screen))</span><br><span class="line">  <span class="keyword">local</span> windowToFocus = #windows &gt; <span class="number">0</span> <span class="keyword">and</span> windows[<span class="number">1</span>] <span class="keyword">or</span> window.desktop()</span><br><span class="line">  windowToFocus:focus()</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- move cursor to center of screen</span></span><br><span class="line">  <span class="keyword">local</span> pt = geometry.rectMidPoint(screen:fullFrame())</span><br><span class="line">  mouse.setAbsolutePosition(pt)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- maximized active window and move to selected monitor</span></span><br><span class="line"><span class="keyword">local</span> moveto = <span class="function"><span class="keyword">function</span><span class="params">(win, n)</span></span></span><br><span class="line">  <span class="keyword">local</span> screens = screen.allScreens()</span><br><span class="line">  <span class="keyword">if</span> n &gt; #screens <span class="keyword">then</span></span><br><span class="line">    alert.show(<span class="string">&quot;Only &quot;</span> .. #screens .. <span class="string">&quot; monitors &quot;</span>)</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">local</span> toWin = screen.allScreens()[n]:name()</span><br><span class="line">    <span class="comment">-- alert.show(&quot;Move &quot; .. win:application():name() .. &quot; to &quot; .. toWin)</span></span><br><span class="line">    layout.apply(&#123;&#123;<span class="literal">nil</span>, win:title(), toWin, layout.maximized, <span class="literal">nil</span>, <span class="literal">nil</span>&#125;&#125;)</span><br><span class="line">    <span class="comment">-- window.focusedWindow():toggleFullScreen()</span></span><br><span class="line">  <span class="keyword">end</span> <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">//move cursor <span class="keyword">in</span> different screens</span><br><span class="line">hotkey.bind(hyperShift, <span class="string">&quot;1&quot;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">  <span class="comment">-- local win = window.focusedWindow()</span></span><br><span class="line">  <span class="comment">-- moveto(win, 1)</span></span><br><span class="line">  focusScreen(screen.allScreens()[<span class="number">1</span>])</span><br><span class="line">  alert.show(<span class="string">&quot;Mac-1&quot;</span>, <span class="number">1</span>)</span><br><span class="line">  <span class="comment">-- alert.show(&quot;Cursor is on the &quot; .. screen.allScreens()[1]:fullFrame().. &quot; monitors &quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line">hotkey.bind(hyperShift, <span class="string">&quot;2&quot;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">  focusScreen(screen.allScreens()[<span class="number">3</span>])</span><br><span class="line">  alert.show(<span class="string">&quot;Redmi-2&quot;</span>, <span class="number">1</span>)</span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line">hotkey.bind(hyperShift, <span class="string">&quot;3&quot;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">  focusScreen(screen.allScreens()[<span class="number">2</span>])</span><br><span class="line">  alert.show(<span class="string">&quot;Dell-3&quot;</span>, <span class="number">1</span>)</span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以上就是Hammerspoon的整体介绍了，希望看到这篇文章的你能有收获~</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://leonardgsf.github.io/2023/07/28/article-title/" data-id="clkpl0u0500009ps6gb5l7lka" data-title="Hammerspoon  一款Mac上提升你工作学习效率的神器" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-hello-world" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/28/hello-world/" class="article-date">
  <time class="dt-published" datetime="2023-07-28T03:59:37.942Z" itemprop="datePublished">2023-07-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/28/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://leonardgsf.github.io/2023/07/28/hello-world/" data-id="clkpl0u0700019ps63td766ux" data-title="Hello World" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/04/16/WebRTC/">WebRTC 1对1实时音视频直播入门</a>
          </li>
        
          <li>
            <a href="/2023/07/28/article-title/">Hammerspoon  一款Mac上提升你工作学习效率的神器</a>
          </li>
        
          <li>
            <a href="/2023/07/28/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>
