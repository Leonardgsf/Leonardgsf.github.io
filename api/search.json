[{"id":"e5bcd557a969ca5425cbf4b6fbc100b6","title":"Macå¼€å‘å¤§æ€å™¨ä¹‹iTerm+NeoVim+Tmux","content":"Macé«˜æ•ˆå¼€å‘ç»„åˆæŠ€iTermTmuxNeoVim","slug":"Macå¼€å‘å¤§æ€å™¨ä¹‹iTerm-NeoVim-Tmux","date":"2024-04-16T10:51:19.000Z","categories_index":"","tags_index":"","author_index":"Feng"},{"id":"3b39a4d8d73647456fc0c99c50fc60aa","title":"WebRTC 1å¯¹1å®æ—¶éŸ³è§†é¢‘ç›´æ’­å…¥é—¨","content":"ğŸ’¡ è®¾æƒ³ä¸€ä¸ªæƒ…æ™¯ï¼šç›¸éš”ä¸¤åœ°çš„Aå’ŒBï¼Œæƒ³è¿›è¡ŒéŸ³è§†é¢‘é€šä¿¡ã€‚åº”è¯¥æ€ä¹ˆå®ç°ï¼Ÿ\nå½“ç„¶ï¼Œå¯¹äºç°åœ¨çš„äººä»¬æ¥è¯´ï¼Œæˆ‘ä»¬æœ‰å¾ˆå¤šçš„æ‰‹æ®µï¼ŒåŒ…æ‹¬å¸¸è§çš„å³æ—¶é€šä¿¡å·¥å…·ï¼ˆQQã€å¾®ä¿¡ï¼‰ã€è…¾è®¯ä¼šè®®ã€é’‰é’‰ç­‰ï¼Œéƒ½å¯ä»¥è½»æ¾å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚\né‚£å¦‚æœç°åœ¨è®©ä½ ä»é›¶æ‰‹åŠ¨æ­å»ºä¸€å¥—è¿œç¨‹ä¸€å¯¹ä¸€çš„éŸ³è§†é¢‘é€šä¿¡ç³»ç»Ÿï¼Œåº”è¯¥æ€ä¹ˆå®ç°å‘¢ï¼Ÿ\nä¸çŸ¥é“ä½ è„‘æµ·ä¸­æœ‰æ²¡æœ‰å®ç°çš„æ€è·¯ã€‚å¦‚æœå¯¹è¿™ä¸€é¢†åŸŸæ¯”è¾ƒé™Œç”Ÿçš„åŒå­¦ï¼Œæš‚æ—¶è«æ…Œï¼Œåœ¨ä¸‹è¾¹çš„æ–‡ç« ä¸­æˆ‘ä»¬ä¼šé€æ­¥æ‹†è§£åŠä»‹ç»æ•´ä¸ªå®ç°æµç¨‹ã€‚å¸Œæœ›å­¦å®Œè¿™ä¸€è¯¾ç¨‹ï¼Œä½ ä¼šæœ‰ä¸€ä¸ªæ¯”è¾ƒæ¸…æ™°çš„è„‰ç»œå’Œå­¦åˆ°å¯è¡Œçš„å®è·µæ–¹æ¡ˆã€‚\nè¯ä¸å¤šè¯´ï¼ŒLetâ€™s goï¼ è®©æˆ‘ä»¬å¼€å§‹ä»Šå¤©çš„è¿œç¨‹é€šä¿¡æ—…ç¨‹å§~\nèƒŒæ™¯æ¦‚è¦\n2011 å¹´ï¼ŒGoogle åˆ›ç«‹äº† WebRTC é¡¹ç›®ï¼Œå…¶æ„¿æ™¯å°±æ˜¯å¯ä»¥åœ¨æµè§ˆå™¨ä¹‹é—´å¿«é€Ÿåœ°å®ç°éŸ³è§†é¢‘é€šä¿¡ã€‚\nWebRTCå®ç°äº†åŸºäºç½‘é¡µçš„è§†é¢‘ä¼šè®®ï¼Œæ ‡å‡†æ˜¯WHATWG åè®®ï¼Œç›®çš„æ˜¯é€šè¿‡æµè§ˆå™¨æä¾›ç®€å•çš„javascriptå°±å¯ä»¥è¾¾åˆ°å®æ—¶é€šè®¯ï¼ˆReal-Time Communications (RTC)ï¼‰èƒ½åŠ›ã€‚\nWebRTCæä¾›äº†è§†é¢‘ä¼šè®®çš„æ ¸å¿ƒæŠ€æœ¯ï¼ŒåŒ…æ‹¬éŸ³è§†é¢‘çš„é‡‡é›†ã€ç¼–è§£ç ã€ç½‘ç»œä¼ è¾“ã€æ˜¾ç¤ºç­‰åŠŸèƒ½ï¼Œå¹¶ä¸”è¿˜æ”¯æŒè·¨å¹³å°ï¼šwindowsï¼Œlinuxï¼Œmacï¼Œandroidã€‚\næˆ‘ä»¬å‰æœŸä½¿ç”¨æ—¶çŸ¥é“åŸºæœ¬çš„APIå°±è¡Œï¼Œå¦‚æœæƒ³ç»§ç»­äº†è§£ï¼Œå¯ä»¥å‚ç…§ä»¥ä¸‹webrtcå®˜æ–¹æ–‡æ¡£ã€‚\n\næ­¥éª¤æ‹†è§£\næ—¢ç„¶é€šä¿¡çš„å†…å®¹æ˜¯éŸ³è§†é¢‘ï¼Œè‚¯å®šéœ€è¦Aã€Bå„è‡ªçš„ç»ˆç«¯æ¥æ£€æµ‹ã€é‡‡é›†æœ¬åœ°çš„éŸ³è§†é¢‘ä¿¡æ¯ã€‚\né‡‡é›†å®Œæ¯•ä¹‹åï¼ŒAã€Béœ€è¦çŸ¥é“å¯¹æ–¹æ˜¯å¦åœ¨çº¿ï¼Œç¡®è®¤å¯¹æ–¹å·²ç»å‡†å¤‡å¥½æ¥æ”¶å’Œä¼ è¾“éŸ³è§†é¢‘æ•°æ®äº†ã€‚\nAã€BåŒæ–¹éœ€è¦æ²Ÿé€šè¿æ¥çš„ä¿¡æ¯åŠåè®®ï¼Œæ–¹ä¾¿å»ºç«‹é€šè·¯ã€‚åå•†éŸ³è§†é¢‘ç¼–è§£ç çš„æ ¼å¼ï¼Œæ–¹ä¾¿åç»­éŸ³è§†é¢‘æ¸²æŸ“å’Œæ’­æ”¾ã€‚\næ¥ä¸‹æ¥å°±æ˜¯æœ€é‡è¦çš„ç‚¹å¯¹ç‚¹è¿æ¥ç¯èŠ‚äº†ï¼ŒWebRTCæä¾›çš„RTCPeerConnectionä¼šå¸®æˆ‘ä»¬æå®šä¸€åˆ‡ã€‚\nè¿æ¥å»ºç«‹åï¼ŒAã€Bçš„éŸ³è§†é¢‘æ•°æ®åœ¨è¿™æ¡è¿æ¥é€šè·¯ä¸Šè¦ä»¥ç›´æ¥æ–¹å¼å„è‡ªä¸é—´æ–­åœ°ä¼ è¾“åˆ°å¦ä¸€ç«¯ã€‚\nå¦‚æœè¿™ä¸ªè¿æ¥é€šè·¯æ–­æ‰çš„è¯ï¼Œå¦‚ä½•ä¿éšœæ•°æ®èƒ½ç¨³å®šåˆ°è¾¾å¦ä¸€ç«¯å‘¢ï¼Ÿæ‰€ä»¥æˆ‘ä»¬è¿˜è¦æœ‰ä¸€ä¸ªä¸­ç»§æœåŠ¡å™¨è¾…åŠ©åŒæ–¹å®ŒæˆéŸ³è§†é¢‘æ•°æ®çš„ä¸­ç»§åŠäº¤æ¢ã€‚\næœ€åéŸ³è§†é¢‘ä¼ è¾“è¿‡æ¥ä¹‹åï¼Œè¦åœ¨å„è‡ªå®¢æˆ·ç«¯å†…è¿›è¡Œè§£ç ã€æ¸²æŸ“ã€æ’­æ”¾ã€‚\n\nä¸ªäººç†è§£ï¼Œå®ç°æ•´ä¸ªæµç¨‹å°±æ˜¯æŠŠå„ä¸ªç»†åˆ†çš„ç¯èŠ‚è·‘é€šï¼Œæœ€åå°†æ‰€æœ‰ç¯èŠ‚è‡ªç„¶ä¸²è”è¿è½¬èµ·æ¥çš„æµç¨‹ã€‚æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬æ¸—é€åˆ°æ¯ä¸€ä¸ªç¯èŠ‚ä¸­å»åˆ†æè§£å†³æ–¹æ¡ˆã€‚\nè·å–æœ¬åœ°éŸ³è§†é¢‘ä¿¡æ¯\néŸ³è§†é¢‘é‡‡é›†åŸºæœ¬æ¦‚å¿µ\næ‘„åƒå¤´ã€‚ç”¨äºæ•æ‰ï¼ˆé‡‡é›†ï¼‰å›¾åƒå’Œè§†é¢‘ã€‚\nå¸§ç‡ã€‚ç°åœ¨çš„æ‘„åƒå¤´åŠŸèƒ½å·²éå¸¸å¼ºå¤§ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ç§’é’Ÿå¯ä»¥é‡‡é›† 30 å¼ ä»¥ä¸Šçš„å›¾åƒï¼Œä¸€äº›å¥½çš„æ‘„åƒå¤´ç”šè‡³å¯ä»¥é‡‡é›† 100 å¼ ä»¥ä¸Šã€‚æˆ‘ä»¬æŠŠæ‘„åƒå¤´ä¸€ç§’é’Ÿé‡‡é›†å›¾åƒçš„æ¬¡æ•°ç§°ä¸ºå¸§ç‡ã€‚å¸§ç‡è¶Šé«˜ï¼Œè§†é¢‘å°±è¶Šå¹³æ»‘æµç•…ã€‚ç„¶è€Œï¼Œåœ¨ç›´æ’­ç³»ç»Ÿä¸­ä¸€èˆ¬ä¸ä¼šè®¾ç½®å¤ªé«˜çš„å¸§ç‡ï¼Œå› ä¸ºå¸§ç‡è¶Šé«˜ï¼Œå çš„ç½‘ç»œå¸¦å®½å°±è¶Šå¤šã€‚\nåˆ†è¾¨ç‡ã€‚æ‘„åƒå¤´é™¤äº†å¯ä»¥è®¾ç½®å¸§ç‡ä¹‹å¤–ï¼Œè¿˜å¯ä»¥è°ƒæ•´åˆ†è¾¨ç‡ã€‚æˆ‘ä»¬å¸¸è§çš„åˆ†è¾¨ç‡æœ‰ 2Kã€1080Pã€720Pã€420P ç­‰ã€‚åˆ†è¾¨ç‡è¶Šé«˜å›¾åƒå°±è¶Šæ¸…æ™°ï¼Œä½†åŒæ—¶ä¹Ÿå¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼Œå³å ç”¨çš„å¸¦å®½ä¹Ÿå°±è¶Šå¤šã€‚æ‰€ä»¥ï¼Œåœ¨ç›´æ’­ç³»ç»Ÿä¸­ï¼Œåˆ†è¾¨ç‡çš„é«˜ä½ä¸ç½‘ç»œå¸¦å®½æœ‰ç´§å¯†çš„è”ç³»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ†è¾¨ç‡ä¼šè·Ÿæ®ä½ çš„ç½‘ç»œå¸¦å®½è¿›è¡ŒåŠ¨æ€è°ƒæ•´ã€‚\nå®½é«˜æ¯”ã€‚åˆ†è¾¨ç‡ä¸€èˆ¬åˆ†ä¸ºä¸¤ç§å®½é«˜æ¯”ï¼Œå³ 16:9 æˆ– 4:3ã€‚4:3 çš„å®½é«˜æ¯”æ˜¯ä»é»‘ç™½ç”µè§†è€Œæ¥ï¼Œè€Œ 16:9 çš„å®½é«˜æ¯”æ˜¯ä»æ˜¾ç¤ºå™¨è€Œæ¥ã€‚ç°åœ¨ä¸€èˆ¬æƒ…å†µä¸‹éƒ½é‡‡ç”¨ 16:9 çš„æ¯”ä¾‹ã€‚\néº¦å…‹é£ã€‚ç”¨äºé‡‡é›†éŸ³é¢‘æ•°æ®ã€‚å®ƒä¸è§†é¢‘ä¸€æ ·ï¼Œå¯ä»¥æŒ‡å®šä¸€ç§’å†…é‡‡æ ·çš„æ¬¡æ•°ï¼Œç§°ä¸ºé‡‡æ ·ç‡ã€‚æ¯ä¸ªé‡‡æ ·ç”¨å‡ ä¸ª bit è¡¨ç¤ºï¼Œç§°ä¸ºé‡‡æ ·ä½æ·±æˆ–é‡‡æ ·å¤§å°ã€‚\nè½¨ï¼ˆTrackï¼‰ã€‚WebRTC ä¸­çš„â€œè½¨â€å€Ÿé‰´äº†å¤šåª’ä½“çš„æ¦‚å¿µã€‚ç«è½¦è½¨é“çš„ç‰¹æ€§ä½ åº”è¯¥éå¸¸æ¸…æ¥šï¼Œä¸¤æ¡è½¨æ°¸è¿œä¸ä¼šç›¸äº¤ã€‚â€œè½¨â€åœ¨å¤šåª’ä½“ä¸­è¡¨è¾¾çš„å°±æ˜¯æ¯æ¡è½¨æ•°æ®éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¼šä¸å…¶ä»–è½¨ç›¸äº¤ï¼Œå¦‚ MP4 ä¸­çš„éŸ³é¢‘è½¨ã€è§†é¢‘è½¨ï¼Œå®ƒä»¬åœ¨ MP4 æ–‡ä»¶ä¸­æ˜¯è¢«åˆ†åˆ«å­˜å‚¨çš„ã€‚\næµï¼ˆStreamï¼‰ã€‚å¯ä»¥ç†è§£ä¸ºå®¹å™¨ã€‚åœ¨ WebRTC ä¸­ï¼Œâ€œæµâ€å¯ä»¥åˆ†ä¸ºåª’ä½“æµï¼ˆMediaStreamï¼‰å’Œæ•°æ®æµï¼ˆDataStreamï¼‰ã€‚å…¶ä¸­ï¼Œåª’ä½“æµå¯ä»¥å­˜æ”¾ 0 ä¸ªæˆ–å¤šä¸ªéŸ³é¢‘è½¨æˆ–è§†é¢‘è½¨ï¼›æ•°æ®æµå¯ä»¥å­˜ 0 ä¸ªæˆ–å¤šä¸ªæ•°æ®è½¨ã€‚\n\n\néŸ³è§†é¢‘é‡‡é›†API\nWebRTCæä¾›äº†ç®€å•æ¸…æ™°çš„APIæ¥è®¿é—®å’Œé‡‡é›†æœ¬åœ°éŸ³é¢‘è®¾å¤‡æˆ–å±å¹•ï¼Œå…·ä½“ä½¿ç”¨å¦‚ä¸‹\njsx//é»˜è®¤é‡‡é›†éŸ³é¢‘ã€è§†é¢‘\nconst constraints = &#123;\n    &#39;video&#39;: true,\n    &#39;audio&#39;: true\n&#125;\n//å®šåˆ¶åŒ–é‡‡é›†å‚æ•°\n    const constraints = &#123;\n        &#39;audio&#39;: &#123;&#39;echoCancellation&#39;: true&#125;,\n        &#39;video&#39;: &#123;\n            &#39;frameRate&#39;: 15, //å¸§ç‡\n            &#39;width&#39;: &#123;&#39;min&#39;: 640&#125;, //é‡‡é›†è§†é¢‘æœ€å°å®½åº¦\n            &#39;height&#39;: &#123;&#39;min&#39;: 480&#125; //é‡‡é›†è§†é¢‘æœ€å°é«˜åº¦\n            &#125;\n        &#125;\n//é‡‡é›†ç”¨æˆ·éŸ³è§†é¢‘\nnavigator.mediaDevices.getUserMedia(constraints)\n    .then(stream =&gt; &#123;\n        console.log(&#39;Got MediaStream:&#39;, stream);\n    &#125;)\n    .catch(error =&gt; &#123;\n        console.error(&#39;Error accessing media devices.&#39;, error);\n    &#125;);\n//é‡‡é›†ç”¨æˆ·å±å¹•æµ\nnavigator.mediaDevices.getDisplayMedia(constraints)\n    .then(stream =&gt; &#123;\n        console.log(&#39;Got MediaStream:&#39;, stream);\n    &#125;)\n    .catch(error =&gt; &#123;\n        console.error(&#39;Error accessing media devices.&#39;, error);\n &#125;);\n\ngetUserMedia&#x2F;getDisplayMediaä¼šè§¦å‘ä¸€ä¸ªæµè§ˆå™¨å¯¹ç”¨æˆ·æœ¬åœ°éŸ³è§†é¢‘è®¾å¤‡çš„æƒé™è¯·æ±‚ã€‚\n\nè‹¥ç”¨æˆ·æ¥å—ï¼Œåˆ™ä¼šæ ¹æ®constraintsè®¾ç½®çš„videoå’Œaudioé…ç½®ï¼Œæ¥é‡‡é›†å¯¹åº”çš„éŸ³é¢‘è½¨ã€è§†é¢‘è½¨ã€‚\nè‹¥ç”¨æˆ·æ‹’ç»ï¼Œåˆ™ä¼šæŠ›å‡ºNotAllowedå¼‚å¸¸ï¼Œä¸€æ—¦æ²¡æœ‰å‘ç°å¯ç”¨çš„è®¾å¤‡ï¼Œåˆ™ä¼šæŠ›å‡ºNotFoundErrorå¼‚å¸¸ã€‚\n\n\nå…·ä½“APIç»†èŠ‚å¯å‚è€ƒå¦‚ä¸‹é“¾æ¥\nMediaDevices - Web APIs | MDN\n\n\n\n\n\n\nä¿¡ä»¤äº¤æ¢åœ¨çº¿çŠ¶æ€ã€åª’ä½“ä¿¡æ¯ã€è¿æ¥ä¿¡æ¯ç­‰ï¼Œï¼ˆé€šè¿‡éƒ¨ç½²ä¿¡ä»¤æœåŠ¡å™¨å®Œæˆï¼Œåæ–‡ä¼šå±•å¼€ä»‹ç»ï¼‰\n\nå®ç°æˆ¿é—´ç®¡ç†ï¼ŒåŠ å…¥æˆ¿é—´ã€é€€å‡ºæˆ¿é—´ã€å‘é€å…¶ä»–æ¶ˆæ¯ç­‰ï¼Œæ–¹ä¾¿å®¢æˆ·ç«¯äº’ç›¸æ˜ç¡®åœ¨çº¿çŠ¶æ€ã€‚\n\näº¤æ¢åª’ä½“åå•†æ•°æ®ï¼ˆéŸ³è§†é¢‘ç¼–ç åè®®ç­‰ï¼‰\n\näº¤æ¢ICEã€ŒInteractive Connectivity Establishmentã€ Candidateï¼ŒåŒ…å«è¿æ¥åè®®ã€IPã€ç«¯å£ç­‰\nICE Candidate ï¼ˆICE å€™é€‰è€…ï¼‰ã€‚å®ƒè¡¨ç¤º WebRTC ä¸è¿œç«¯é€šä¿¡æ—¶ä½¿ç”¨çš„åè®®ã€IP åœ°å€å’Œç«¯å£ï¼Œä¸€èˆ¬ç”±ä»¥ä¸‹å­—æ®µç»„æˆï¼šæœ¬åœ° IP åœ°å€æœ¬åœ°ç«¯å£å·å€™é€‰è€…ç±»å‹ï¼ŒåŒ…æ‹¬ hostã€srflx å’Œ relayä¼˜å…ˆçº§ä¼ è¾“åè®®è®¿é—®æœåŠ¡çš„ç”¨æˆ·åâ€¦â€¦\nbash&#123;\n  IP: xxx.xxx.xxx.xxx,\n  port: number,\n  type: host/srflx/relay,\n  priority: number,\n  protocol: UDP/TCP,\n  usernameFragment: string\n  ...\n&#125;\n\nç‚¹å¯¹ç‚¹è¿æ¥é€šä¿¡çš„åŒæ–¹éƒ½éœ€è¦æ–°å»ºä¸€ä¸ªRTCPeerConnectionå¯¹è±¡ï¼Œå®ç°ç‚¹å¯¹ç‚¹çš„P2Pè¿æ¥ã€‚RTCPeerConnectionå¯¹è±¡ä¸»è¦å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š\n\næ‰¿è½½æœ¬åœ°åŠè¿œç«¯éŸ³è§†é¢‘ç­‰æ•°æ®æµï¼Œé€šè¿‡ç‚¹å¯¹ç‚¹æˆ–è€…ä¸­ç»§çš„å½¢å¼å‘é€æ•°æ®ï¼ŒåŒæ—¶ç»‘å®šäº†ç›¸åº”çš„å›è°ƒå‡½æ•°ï¼Œå½“æœ‰è¿œç«¯çš„æ•°æ®æµåˆ°æ¥æ—¶ï¼Œæé†’ä¸šåŠ¡å±‚è¿›è¡Œåç»­æ¸²æŸ“æ“ä½œ\n\nè‡ªåŠ¨è·å–åª’ä½“æè¿°ä¿¡æ¯SDPï¼ŒåŒæ—¶å­˜å‚¨é€šè¿‡ä¿¡ä»¤æœåŠ¡å™¨äº¤æ¢è·å–åˆ°çš„è¿œç«¯SDPä¿¡æ¯ã€‚\n\næ”¶é›†ICEï¼ˆInteractive Connectivity Establishmentï¼‰ Candidateã€‚åŒæ—¶å­˜å‚¨é€šè¿‡ä¿¡ä»¤æœåŠ¡å™¨äº¤æ¢è·å–åˆ°çš„è¿œç«¯ ICE Candidateä¿¡æ¯ï¼Œä»¥ä¾¿è¿›è¡Œç«¯ä¸ç«¯ä¹‹é—´çš„è¿æ¥\n\nhost ç±»å‹ï¼Œå³æœ¬æœºå†…ç½‘çš„ IP å’Œç«¯å£ï¼›æœ€å®¹æ˜“æ‰‹æœºçš„Candidate\nsrflx ç±»å‹, é€šè¿‡STUNåè®®å®ç°ï¼Œå³æœ¬æœº NAT æ˜ å°„åçš„å¤–ç½‘çš„ IP å’Œç«¯å£ï¼›é€šè¿‡åœ¨å¤–ç½‘æ­å»ºä¸€ä¸ª STUN æœåŠ¡å™¨ï¼Œé€šè¿‡å‘æ•°æ®åŒ…çš„æ–¹å¼è·å–è‡ªå·±å¤–ç½‘IPå’Œç«¯å£\nrelay ç±»å‹ï¼Œå³ä¸­ç»§æœåŠ¡å™¨çš„ IP å’Œç«¯å£ï¼›é€šè¿‡å‘ TURN æœåŠ¡å™¨å‘é€ Allocation æŒ‡ä»¤ï¼Œrelay æœåŠ¡å°±ä¼šåœ¨æœåŠ¡å™¨ç«¯åˆ†é…ä¸€ä¸ªæ–°çš„ relay ç«¯å£ï¼Œç”¨äºä¸¤ç«¯ä¸­è½¬ UDP æ•°æ®æŠ¥ã€‚\n\n\n\n\nNATç©¿è¶Šå»ºç«‹è¿æ¥ï¼ŒWebRTCåº•å±‚éƒ½å¸®æˆ‘ä»¬å®ç°äº†ï¼Œè¿™é‡Œä¸å±•å¼€ä»‹ç»äº†ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å‚è€ƒä»¥ä¸‹æ–‡æ¡£\nWebRTCéŸ³è§†é¢‘ä¼ è¾“åŸºç¡€ï¼šNATç©¿é€\n\n\næ•°æ®ä¸­è½¬ç‚¹å¯¹ç‚¹è¿æ¥å¤±è´¥çš„æ•°æ®ä¸­è½¬ï¼ˆé€šè¿‡TURNæœåŠ¡å™¨å®ç°ï¼‰\n\nåœ¨P2Pè¿æ¥å¤±è´¥æ—¶ï¼Œæä¾›æ•°æ®ä¸­ç»§æœåŠ¡æ—¶\nåœ¨ICEäº¤æ¢çš„è¿‡ç¨‹ä¸­ï¼ŒååŠ©å®¢æˆ·ç«¯è·å–è‡ªå·±çš„å¤–ç½‘IPå’Œç«¯å£\n\nä»¥ä¸Šå°±æ˜¯æˆ‘ä»¬è¿œç¨‹é€šä¿¡çš„å…³é”®æ­¥éª¤ï¼Œä¸‹å›¾å°±æ˜¯è¿™ä¸ªå®Œæ•´çš„æµç¨‹å‘ˆç°ã€‚å›¾ç‰‡æ¥æºäºæå®¢æ—¶é—´æè¶…è€å¸ˆçš„è¯¾ç¨‹ã€Šä»0æ‰“é€ éŸ³è§†é¢‘ç›´æ’­ç³»ç»Ÿã€‹\n\nä¸Šå›¾æ˜¯æ•´ä¸ª WebRTC 1 å¯¹ 1 éŸ³è§†é¢‘å®æ—¶é€šè¯çš„è¿‡ç¨‹å›¾ã€‚é€šè¿‡è¿™å¹…å›¾ï¼Œä½ å¯ä»¥çœ‹å‡ºè¦å®ç° 1 å¯¹ 1 éŸ³è§†é¢‘å®æ—¶é€šè¯å…¶è¿‡ç¨‹è¿˜æ˜¯è›®å¤æ‚çš„ã€‚\nè¿™å¹…å›¾ä»å¤§çš„æ–¹é¢å¯ä»¥åˆ†ä¸º 4 éƒ¨åˆ†ï¼Œå³ä¸¤ä¸ª WebRTC ç»ˆç«¯ï¼ˆä¸Šå›¾ä¸­çš„ä¸¤ä¸ªå¤§æ–¹æ¡†ï¼‰ã€ä¸€ä¸ª Signalï¼ˆä¿¡ä»¤ï¼‰æœåŠ¡å™¨å’Œä¸€ä¸ª STUN&#x2F;TURN æœåŠ¡å™¨ã€‚\nWebRTC ç»ˆç«¯ï¼Œè´Ÿè´£éŸ³è§†é¢‘é‡‡é›†ã€ç¼–è§£ç ã€NAT ç©¿è¶Šã€éŸ³è§†é¢‘æ•°æ®ä¼ è¾“ã€‚\nSignal æœåŠ¡å™¨ï¼Œè´Ÿè´£ä¿¡ä»¤å¤„ç†ï¼Œå¦‚åŠ å…¥æˆ¿é—´ã€ç¦»å¼€æˆ¿é—´ã€åª’ä½“åå•†æ¶ˆæ¯çš„ä¼ é€’ç­‰ã€‚\nSTUN&#x2F;TURN æœåŠ¡å™¨ï¼Œè´Ÿè´£è·å– WebRTC ç»ˆç«¯åœ¨å…¬ç½‘çš„ IP åœ°å€ï¼Œä»¥åŠ NAT ç©¿è¶Šå¤±è´¥åçš„æ•°æ®ä¸­è½¬ã€‚\næ¥ä¸‹æ¥æˆ‘ä»¬ä¾æ®ä¸Šè¾¹çš„æ•´ä½“æµç¨‹åŠç†è®ºæŒ‡å¯¼ï¼Œæ¥è¿›è¡Œå…·ä½“çš„å®ç°ç¯èŠ‚~\nå…·ä½“å®ç°å‰ç½®å‡†å¤‡\n2Må¸¦å®½ä»¥ä¸Šçš„äº‘ä¸»æœº+åŸŸå+httpsè¯ä¹¦\nä¸ç®¡æ˜¯æ­å»ºä¿¡ä»¤å’Œä¸­ç»§æœåŠ¡å™¨ã€è¿˜æ˜¯æä¾›å®¢æˆ·ç«¯åœ¨æµè§ˆå™¨è®¿é—®åŒä¸€å¥—é€šä¿¡ä»£ç ï¼Œéƒ½éœ€è¦ä¸€å°äº‘ä¸»æœºã€‚\nä¸ºä½•éœ€è¦ 2M ä»¥ä¸Šå¸¦å®½çš„å¸¦å®½å‘¢ï¼Ÿï¼Œå¯¹äºä¸€è·¯ 720P çš„è§†é¢‘ï¼Œä¸€èˆ¬æƒ…å†µä¸‹éœ€è¦ 1.2M çš„å¸¦å®½ï¼Œå› æ­¤åœ¨ä¸¤äººé€šä¿¡æ—¶ï¼Œå¦‚æœéƒ½èµ°æœåŠ¡å™¨ä¸­è½¬çš„è¯å°±éœ€è¦ 2.4M çš„å¸¦å®½äº†ã€‚æ‰€ä»¥ä¸ºäº†ä¿è¯åŒæ–¹é€šä¿¡é¡ºç•…ï¼Œå¸¦å®½æ˜¯å¿…é¡»è¦èƒ½è·Ÿå¾—ä¸Šçš„ã€‚\nå› ä¸ºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼Œè®¿é—®éŸ³è§†é¢‘æ—¶ï¼Œéƒ½éœ€è¦ç›¸åº”çš„httpsè¯ä¹¦ï¼Œæ‰€ä»¥åŸŸåå’Œhttpsè¯ä¹¦éƒ½æ˜¯éœ€è¦å‡†å¤‡çš„ã€‚\n\n\n\næœåŠ¡å™¨ç¯å¢ƒéƒ¨ç½²\nwebæœåŠ¡å™¨æ­å»º\n\nä¸»è¦æ˜¯ç»™å®¢æˆ·ç«¯(æµè§ˆå™¨)æä¾›æ‰§è¡Œçš„æ–‡ä»¶(htmlã€cssã€js)ï¼Œæˆ‘ä»¬ç¤ºä¾‹ä¸­ç”¨Node.jsæ¥å®ç°ï¼Œä¸»è¦æ˜¯è€ƒè™‘åˆ°åç»­ä¿¡ä»¤æœåŠ¡ä¾èµ–äºNode.jsã€‚ä¸‹è¾¹æ˜¯ä»£ç ç¤ºä¾‹ï¼Œæˆ‘ä»¬æš‚å‘½åä¸ºserver.js\njavascriptvar https = require(&#39;https&#39;);\nvar express = require(&#39;express&#39;);\nvar serveIndex = require(&#39;serve-index&#39;);\n...\n//ä½¿ç”¨expresså®ç°WEBæœåŠ¡\nvar app = express(); \napp.use(serveIndex(&#39;./public&#39;));\napp.use(express.static(&#39;./public&#39;));\n\n//HTTPS è¯ä¹¦å’Œå¯†é’¥æ–‡ä»¶\nvar options = &#123;\n  key : fs.readFileSync(&#39;./cert/yourrtc.cn.key&#39;),\n  cert: fs.readFileSync(&#39;./cert/yourrtc.cn.pem&#39;)\n&#125;\n\n//https server\nvar https_server = https.createServer(options, app);\nvar io = socketIo.listen(https_server);\nhttps_server.listen(443, &#39;0.0.0.0&#39;);\n...â€‹\n\n\n\nä¿¡ä»¤æœåŠ¡æ­å»º\n\næˆ‘ä»¬åŒæ ·ä½¿ç”¨Node.jsæ¥æ­å»ºä¿¡ä»¤æœåŠ¡å™¨ï¼Œä»£ç å¯ä»¥æ”¾åœ¨ä¸Šè¿°çš„server.jsä¸­ï¼Œåªéœ€æ·»åŠ socketçš„æœåŠ¡ç«¯éƒ¨åˆ†å³å¯\njavascriptconst static = require(&#39;node-static&#39;);\nconst http = require(&#39;http&#39;);\nconst file = new(static.Server)();\nconst app = http.createServer(function (req, res) &#123;\n  file.serve(req, res);\n&#125;).listen(2013);\n\nconst io = require(&#39;socket.io&#39;).listen(app); //ä¾¦å¬ 2013\n\nio.sockets.on(&#39;connection&#39;, (socket) =&gt; &#123;\n\n  // convenience function to log server messages to the client\n  function log()&#123; \n    const array = [&#39;&gt;&gt;&gt; Message from server: &#39;]; \n    for (var i = 0; i &lt; arguments.length; i++) &#123;\n      array.push(arguments[i]);\n    &#125; \n      socket.emit(&#39;log&#39;, array);\n  &#125;\n\n  socket.on(&#39;message&#39;, (message) =&gt; &#123; //æ”¶åˆ°messageæ—¶ï¼Œè¿›è¡Œå¹¿æ’­\n    log(&#39;Got message:&#39;, message);\n    // for a real app, would be room only (not broadcast)\n    socket.broadcast.emit(&#39;message&#39;, message); //åœ¨çœŸå®çš„åº”ç”¨ä¸­ï¼Œåº”è¯¥åªåœ¨æˆ¿é—´å†…å¹¿æ’­\n  &#125;);\n\n  socket.on(&#39;create or join&#39;, (room) =&gt; &#123; //æ”¶åˆ° â€œcreate or joinâ€ æ¶ˆæ¯\n\n  var clientsInRoom = io.sockets.adapter.rooms[room];\n    var numClients = clientsInRoom ? Object.keys(clientsInRoom.sockets).length : 0; //æˆ¿é—´é‡Œçš„äººæ•°\n\n    log(&#39;Room &#39; + room + &#39; has &#39; + numClients + &#39; client(s)&#39;);\n    log(&#39;Request to create or join room &#39; + room);\n\n    if (numClients === 0)&#123; //å¦‚æœæˆ¿é—´é‡Œæ²¡äºº\n      socket.join(room);\n      socket.emit(&#39;created&#39;, room); //å‘é€ &quot;created&quot; æ¶ˆæ¯\n    &#125; else if (numClients === 1) &#123; //å¦‚æœæˆ¿é—´é‡Œæœ‰ä¸€ä¸ªäºº\n    io.sockets.in(room).emit(&#39;join&#39;, room);\n      socket.join(room);\n      socket.emit(&#39;joined&#39;, room); //å‘é€ â€œjoinedâ€æ¶ˆæ¯\n    &#125; else &#123; // max two clients\n      socket.emit(&#39;full&#39;, room); //å‘é€ &quot;full&quot; æ¶ˆæ¯\n    &#125;\n    socket.emit(&#39;emit(): client &#39; + socket.id +\n      &#39; joined room &#39; + room);\n    socket.broadcast.emit(&#39;broadcast(): client &#39; + socket.id +\n      &#39; joined room &#39; + room);\n\n  &#125;);\n\n&#125;);\n\n\nturnæœåŠ¡å™¨æ­å»º\n\nturnæœåŠ¡å™¨ä¸»è¦æ˜¯ç”¨æ¥åœ¨ç‚¹å¯¹ç‚¹è¿æ¥å¤±è´¥çš„æ—¶å€™ï¼Œè¿›è¡Œæ•°æ®ä¸­ç»§è½¬å‘çš„ã€‚åŒæ—¶ä¹Ÿå¯ç”¨äºå¸®åŠ©å®¢æˆ·ç«¯è·å–è‡ªå·±çš„å¤–ç½‘IPåœ°å€å’Œç«¯å£ï¼ŒååŠ©å®¢æˆ·ç«¯å»ºç«‹ç‚¹å¯¹ç‚¹çš„è¿æ¥ã€‚\næˆ‘ä»¬é‡‡ç”¨ç›®å‰æœ€è‘—åçš„TurnæœåŠ¡å™¨ï¼Œç”±Google å‘èµ·çš„å¼€æºé¡¹ç›®coturnï¼Œåœ°å€ä¸ºcoturnï¼Œ\nå®‰è£…coturn\nä» https://github.com/coturn/coturn ä¸‹è½½ coturn ä»£ç ï¼›\næ‰§è¡Œ .&#x2F;configure â€“prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;coturn ç”Ÿæˆ Makefileï¼›\næ‰§è¡Œ make æ¥ç¼–è¯‘ coturnï¼›\næ‰§è¡Œ sudo make install è¿›è¡Œå®‰è£…ã€‚\n\n\né…ç½®coturn\nç¼–è¾‘coturnçš„é…ç½®æ–‡ä»¶\nshellvi /etc/coturn/turnserver.conf\nä¿®æ”¹ä»¥ä¸‹å››é¡¹é…ç½®å³å¯\nshelluser=use:pas #è¿æ¥turnæœåŠ¡å™¨çš„ç”¨æˆ·åå’Œå¯†ç \nrealm=yourrtc.cn #è®¾ç½®ä¸ºä½ çš„è®¿é—®åŸŸå\nlistening-port=3478 #ç›‘å¬ç«¯å£ï¼Œå›ºå®šä¸º3478\nexternal-ip=1.2.3.55 #æ›´æ¢ä¸ºä½ çš„å…¬ç½‘IPâ€‹\n\n\n\n\n\n\nå®¢æˆ·ç«¯ä»£ç ç¼–å†™éƒ¨ç½²\nå®¢æˆ·ç«¯ä½¿ç”¨ä¿¡ä»¤æœåŠ¡,å»ºç«‹client.jsæ–‡ä»¶\n\njavascriptvar isInitiator;\n\nroom = prompt(&#39;Enter room name:&#39;); //å¼¹å‡ºä¸€ä¸ªè¾“å…¥çª—å£\n\nconst socket = io.connect(); //ä¸æœåŠ¡ç«¯å»ºç«‹socketè¿æ¥\n\nif (room !== &#39;&#39;) &#123; //å¦‚æœæˆ¿é—´ä¸ç©ºï¼Œåˆ™å‘é€ &quot;create or join&quot; æ¶ˆæ¯\n  console.log(&#39;Joining room &#39; + room);\n  socket.emit(&#39;create or join&#39;, room);\n&#125;\n\n//socketçš„messageæ¶ˆæ¯æ˜¯ä¸»è¦çš„äº¤æ¢æ¸ é“ï¼Œäº¤æ¢åŒæ–¹çš„åª’ä½“ä¿¡æ¯åŠè¿æ¥ä¿¡æ¯\nsocket.on(&#39;message&#39;, (roomid, data) =&gt; &#123;\n    console.log(&#39;receive message!&#39;, roomid, data);\n\n    if(data === null || data === undefined)&#123;\n        console.error(&#39;the message is invalid!&#39;);\n        return;\t\n    &#125;\n\n    if(data.hasOwnProperty(&#39;type&#39;) &amp;&amp; data.type === &#39;offer&#39;) &#123;\n        \n        offer.value = data.sdp;\n\n        pc.setRemoteDescription(new RTCSessionDescription(data));\n\n        //create answer\n        pc.createAnswer()\n            .then(getAnswer)\n            .catch(handleAnswerError);\n\n    &#125;else if(data.hasOwnProperty(&#39;type&#39;) &amp;&amp; data.type == &#39;answer&#39;)&#123;\n        answer.value = data.sdp;\n        pc.setRemoteDescription(new RTCSessionDescription(data));\n    \n    &#125;else if (data.hasOwnProperty(&#39;type&#39;) &amp;&amp; data.type === &#39;candidate&#39;)&#123;\n        var candidate = new RTCIceCandidate(&#123;\n            sdpMLineIndex: data.label,\n            candidate: data.candidate\n        &#125;);\n        pc.addIceCandidate(candidate);\t\n    \n    &#125;else&#123;\n        console.log(&#39;the message is invalid!&#39;, data);\n    \n    &#125;\n\n&#125;)\nsocket.on(&#39;join&#39;, (room) =&gt; &#123; //å¦‚æœä»æœåŠ¡ç«¯æ”¶åˆ° â€œjoin&quot; æ¶ˆæ¯\n  console.log(&#39;Making request to join room &#39; + room);\n  console.log(&#39;You are the initiator!&#39;);\n  //æ ¹æ®ä¿¡ä»¤æœåŠ¡çš„é€šçŸ¥æ¥å»ºç«‹ç›¸åº”çš„è¿æ¥åŠç»‘å®šæµï¼Œåç»­æœ‰ç¤ºä¾‹\n  createPeerConnection(); //åŠ å…¥æˆ¿é—´æˆåŠŸåï¼Œå¼€å§‹å»ºç«‹PeerConnectionå¯¹è±¡\n  bindTracks(); //ç»‘å®šç›¸åº”çš„æµ\n\n&#125;);\n\nsocket.on(&#39;log&#39;, (array) =&gt; &#123;\n  console.log.apply(console, array);\n&#125;);\n//å®šä¹‰å®¢æˆ·ç«¯å‘é€socketæ¶ˆæ¯çš„æ–¹æ³•\nfunction sendMessage(roomid, data)&#123;\n\n    console.log(&#39;send message to other end&#39;, roomid, data);\n    if(!socket)&#123;\n        console.log(&#39;socket is null&#39;);\n    &#125;\n    socket.emit(&#39;message&#39;, roomid, data);\n&#125;\n//å¡«å†™æœ¬åœ°çš„åª’ä½“ä¿¡æ¯ï¼Œå¹¶é€šè¿‡ä¿¡ä»¤æœåŠ¡å‘é€åˆ°è¿œç«¯ï¼Œé€‚åˆå½“å‰å®¢æˆ·ç«¯ä¸ºåˆå§‹å‘èµ·è€…ã€‚\nfunction getOffer(desc)&#123;\n    pc.setLocalDescription(desc);\n    offer.value = desc.sdp;\n    offerdesc = desc;\n    //send offer sdp\n    sendMessage(roomid, offerdesc);\t\n&#125;\n\n//æ”¶åˆ°è¿œç«¯çš„åª’ä½“ä¿¡æ¯æ—¶ï¼Œå»ºç«‹æœ¬å®¢æˆ·ç«¯åº”ç­”çš„åª’ä½“ä¿¡æ¯ï¼Œå¹¶å‘é€åˆ°è¿œç«¯ï¼Œé€‚åˆå½“å‰å®¢æˆ·ç«¯ä¸ºåº”ç­”è€…\nfunction getAnswer(desc)&#123;\n    pc.setLocalDescription(desc);\n    answer.value = desc.sdp;\n    //send answer sdp\n    sendMessage(roomid, desc);\n&#125;\nå®¢æˆ·ç«¯ç»“åˆturnæœåŠ¡å™¨ï¼Œè¿›è¡Œç‚¹å¯¹ç‚¹çš„è¿æ¥ä¸æµçš„ä¼ è¾“ï¼Œä¹Ÿåœ¨client.jsç¼–å†™\n\njavascript//å®šä¹‰turnæœåŠ¡å™¨çš„åŸºç¡€é…ç½®ï¼Œä¸ä¸Šæ–‡ä¸­coturnæœåŠ¡å™¨çš„é…ç½®ä¸€è‡´å³å¯ã€‚\nvar pcConfig = &#123;\n  &#39;iceServers&#39;: [&#123; //æŒ‡å®š ICE æœåŠ¡å™¨ä¿¡ä»¤\n    &#39;urls&#39;: &#39;turn:stun.al.learningrtc.cn:3478&#39;, //turnæœåŠ¡å™¨åœ°å€ï¼Œéœ€è¦åŠ `turn:`çš„å›ºå®šå‰ç¼€\n    &#39;credential&#39;: &quot;passwd&quot;, //turnæœåŠ¡å™¨å¯†ç ï¼Œä½ è¦ç”¨è‡ªå·±çš„ \n    &#39;username&#39;: &quot;username&quot;  //turnæœåŠ¡å™¨ç”¨æˆ·åï¼Œä½ è¦ç”¨è‡ªå·±çš„\n  &#125;]\n&#125;;\n\n//å»ºç«‹RTCPeerConnectionå¯¹è±¡ï¼Œæ³¨å†Œæ”¶åˆ°æ•°æ®æµçš„å›è°ƒäº‹ä»¶\nfunction createPeerConnection()&#123;\n \n  if(!pc)&#123;\n    pc = new RTCPeerConnection(pcConfig); //åˆ›å»ºpeerconnectionå¯¹è±¡\n    ...\n    pc.ontrack = getRemoteStream; //å½“è¿œç«¯çš„trackåˆ°æ¥æ—¶ä¼šè§¦å‘è¯¥äº‹ä»¶\n  &#125;else &#123;\n    console.log(&#39;the pc have be created!&#39;);\n  &#125;\n\n  return;\n&#125;\n\n//å½“è¿œç¨‹éŸ³è§†é¢‘æµæ•°æ®ä¼ è¾“å®Œæˆçš„æ—¶å€™ï¼Œè¿›è¡Œæ¸²æŸ“æ’­æ”¾æ“ä½œ\nvar remoteVideo = document.querySelector(&#39;video#remotevideo&#39;);\nfunction getRemoteStream(e)&#123;  //äº‹ä»¶å¤„ç†å‡½æ•°\n  remoteStream = e.streams[0]; //ä¿å­˜è¿œç«¯çš„æµ\n  remoteVideo.srcObject = e.streams[0]; //ä¸HTMLä¸­çš„è§†é¢‘æ ‡ç­¾ç»‘å®š\n&#125;\n\n\n//æŠŠæœ¬åœ°çš„åª’ä½“æµæ·»åŠ åˆ°RTCPeerConnectionå¯¹è±¡é‡Œè¾¹ï¼Œä¾›åç»­è¿œç¨‹ä¼ è¾“\nfunction bindTracks()&#123;\n  //add all track into peer connection\n  localStream.getTracks().forEach((track)=&gt;&#123;\n    pc.addTrack(track, localStream); //å°†trackä¸peerconnectionç»‘å®š\n  &#125;);\n&#125;\nå†æ·»åŠ ä¸€äº›é™æ€ä»£ç ï¼Œæ–¹ä¾¿æ¸²æŸ“å’Œé¢„è§ˆæœ¬åœ°åŠè¿œç«¯çš„éŸ³è§†é¢‘\n\nhtml&lt;div&gt;\n    &lt;button id=&quot;connserver&quot;&gt;Connect Sig Server&lt;/button&gt;\n    &lt;button id=&quot;start&quot; disabled&gt;Start&lt;/button&gt;\t\n    &lt;button id=&quot;call&quot; disabled&gt;Call&lt;/button&gt;\t\n    &lt;button id=&quot;hangup&quot; disabled&gt;HangUp&lt;/button&gt;\t\n    &lt;button id=&quot;leave&quot; disabled&gt;Leave&lt;/button&gt;\t\n&lt;/div&gt;\n\n\n&lt;div&gt;\n    &lt;input id=&quot;shareDesk&quot; type=&quot;checkbox&quot;/&gt;&lt;label for=&quot;shareDesk&quot;&gt;Share Desktop&lt;/label&gt;\n&lt;/div&gt;\n&lt;div id=&quot;preview&quot;&gt;\n    &lt;div width=&quot;40%&quot;&gt;\n        &lt;h2&gt;Local:&lt;/h2&gt;\n        &lt;video id=&quot;localvideo&quot; autoplay playsinline muted&gt;&lt;/video&gt;\n        &lt;h2&gt;Offer SDP:&lt;/h2&gt;\n        &lt;textarea id=&quot;offer&quot; style=&quot;display: none;&quot;&gt;&lt;/textarea&gt;\n    &lt;/div&gt;\n    &lt;div width=&quot;40%&quot;&gt;\n        &lt;h2&gt;Remote:&lt;/h2&gt;\n        &lt;video id=&quot;remotevideo&quot; autoplay playsinline&gt;&lt;/video&gt;\n        &lt;h2&gt;Answer SDP:&lt;/h2&gt;\n        &lt;textarea id=&quot;answer&quot; style=&quot;display: none;&quot;&gt;&lt;/textarea&gt;\n    &lt;/div&gt;\n    &lt;div&gt;\n        &lt;h2&gt;Chat:&lt;/h2&gt;\n        &lt;textarea id=&quot;chat&quot; disabled&gt;&lt;/textarea&gt;\n        &lt;textarea id=&quot;sendtxt&quot; disabled&gt;&lt;/textarea&gt;\n        &lt;button id=&quot;send&quot; disabled&gt;Send&lt;/button&gt;\n    &lt;/div&gt;\n&lt;/div&gt;æ€»ç»“ä»¥ä¸Šå°±æ˜¯æµè§ˆå™¨ç«¯å®ç° 1 å¯¹ 1 å®æ—¶é€šè¯çš„æ•´ä½“é€»è¾‘ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å¼•å…¥äº†WebRTCè¿™é¡¹æŠ€æœ¯ï¼Œå¹¶é€æ­¥æ‹†è§£äº†é€šä¿¡çš„åŸºæœ¬æ­¥éª¤å’Œè¦ç´ ï¼Œæœ€åå†æŠŠæ•´ä½“çš„è¿è¡Œç¯å¢ƒå’Œé€šä¿¡æ¨¡å—å±•å¼€ä»‹ç»ã€‚\nä¸å¾—ä¸è¯´ï¼Œæ¶‰åŠåˆ°çš„æŠ€æœ¯å’Œæœ¯è¯­çŸ¥è¯†è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œé‰´äºèƒ½åŠ›å’Œç¯‡å¹…æœ‰é™ï¼Œæ­¤ç¯‡æ–‡ç« æ— æ³•æ·±å…¥åˆ°ä¼—å¤šçš„çŸ¥è¯†ç‚¹ï¼Œæ¯”å¦‚NATç©¿è¶Šç­‰ã€‚å¦‚æœä½ å¯¹éŸ³è§†é¢‘é€šä¿¡æ„Ÿå…´è¶£çš„è¯ï¼Œå¸Œæœ›è¿™ç¯‡åšå®¢èƒ½å¸®åŠ©ä½ ç†æ¸…æ€è·¯ï¼Œå¸®ä½ å…¥é—¨ã€‚\nå‚è€ƒèµ„æ–™æå®¢æ—¶é—´-æè¶…è€å¸ˆ-ä» 0 æ‰“é€ éŸ³è§†é¢‘ç›´æ’­ç³»ç»Ÿ\nGetting started with WebRTC\nWebRTCè¿›é˜¶\nWebRTC-demo\n","slug":"WebRTC","date":"2024-04-16T10:09:03.000Z","categories_index":"","tags_index":"","author_index":"Feng"},{"id":"a0870e85994130b27751635f41a5a534","title":"Hammerspoon  ä¸€æ¬¾Macä¸Šæå‡ä½ å·¥ä½œå­¦ä¹ æ•ˆç‡çš„ç¥å™¨","content":"ä»€ä¹ˆæ˜¯Hammerspoonï¼ŸHammerspoonæ˜¯ä¸€æ¬¾é’ˆå¯¹macOSçš„è‡ªåŠ¨åŒ–å·¥å…·ã€‚å…¶æ ¸å¿ƒä¸æœ¬è´¨æ˜¯åœ¨luaè„šæœ¬å¼•æ“ä¸æ“ä½œç³»ç»Ÿä¹‹é—´çš„æ¡¥æ¢å’Œé€šé“ï¼Œèµ‹äºˆç”¨æˆ·æå¤§çš„èƒ½åŠ›å’Œè‡ªç”±åº¦å»è°ƒç”¨ç³»ç»ŸåŠŸèƒ½ï¼Œæœ€å¤§åŒ–åœ°å‘æŒ¥ç³»ç»ŸåŠŸèƒ½ï¼Œæå‡æˆ‘ä»¬çš„å­¦ä¹ å’Œå·¥ä½œæ•ˆç‡ã€‚\nè‡³äºluaçš„è¯­æ³•ï¼Œå¯¹äºç¨å¾®æœ‰ç¼–ç¨‹åŸºç¡€çš„åŒå­¦æ¥è¯´éƒ½å¾ˆå¥½ç†è§£ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªluaçš„å¿«é€Ÿå­¦ä¹ å‚è€ƒé“¾æ¥ï¼Œå¯ä»¥å‚è€ƒï¼Œåœ¨æ­¤å°±ä¸å±•å¼€ä»‹ç»äº†ã€‚\n\nLuaè¯­è¨€å¿«é€Ÿå…¥é—¨\n\nHammerspoonå¯ä»¥å¸®æˆ‘åšä»€ä¹ˆï¼Ÿé¡¾åæ€ä¹‰ï¼ŒHammerspoonç¿»è¯‘è¿‡æ¥ä¸ºé”¤å­å‹ºå­ï¼Œæ—¢èƒ½å¸®ä½ å¹²ä¸€äº›ä½“åŠ›æ´»ï¼Œä¹Ÿèƒ½è¾…åŠ©ä½ å®Œæˆä¸€äº›æ—¥å¸¸ç²¾ç»†çš„å·¥ä½œã€‚\nä½ å¯ä»¥ç¼–å†™ç®€å•çš„luaä»£ç ä¸macOSç³»ç»Ÿè¿›è¡Œå……åˆ†äº¤äº’ã€‚æ§åˆ¶å’Œæ“ä½œMacOSç³»ç»Ÿçš„åº”ç”¨è½¯ä»¶ã€çª—å£ã€è¾“å…¥æ³•ã€é¼ æ ‡ã€æ–‡ä»¶ç³»ç»Ÿã€å£°éŸ³è®¾å¤‡ã€å±å¹•ã€å‰ªè´´æ¿ã€wifiç­‰ç­‰ã€‚\næˆ‘æ¥ä¾ç…§æˆ‘è‡ªèº«çš„æ—¥å¸¸ä½¿ç”¨åœºæ™¯æ¥ä¸¾å‡ ä¸ªä¾‹å­ã€‚\n\nä¸€é”®å”¤èµ·å„ä¸ªç‰¹å®šåº”ç”¨\n   æˆ‘ä»¬å·¥ä½œæˆ–å­¦ä¹ æ—¶å¯èƒ½ç»å¸¸ä¼šæ‰“å¼€å¤šä¸ªè½¯ä»¶ï¼Œå¹¶åœ¨è¿™å‡ ä¸ªåº”è½¯ä»¶è¿›è¡Œé¢‘ç¹åˆ‡æ¢ã€‚å½“ç„¶ï¼ŒMacä¸‹ç”¨è§¦æ‘¸æ¿æˆ–è€…Cmd+Tabå¯ä»¥å®ç°æ–¹ä¾¿åˆ‡æ¢ã€‚æ‰“å¼€2-3ä¸ªè½¯ä»¶æ—¶åŸç”Ÿçš„æ–¹æ³•å¯èƒ½ä¼šå¾ˆæ–¹ä¾¿ï¼Œä½†å¦‚æœä½ æ‰“å¼€5ä¸ªåº”ç”¨ä»¥ä¸Šæ—¶ï¼Œä½ éƒ¨åˆ†æ—¶é—´å¯èƒ½å°±å¾—æ¶ˆè€—åœ¨ä¸€ç›´åˆ†è¾¨ã€æŒ‘é€‰çœŸæ­£æƒ³æ‰“å¼€çš„è½¯ä»¶ã€‚\n  è€Œä½¿ç”¨Hammerspoonä½ å¯ä»¥å®šä¹‰ä¸€ç³»åˆ—çš„å¿«æ·é”®ï¼Œæ¥è½»æ¾å”¤èµ·ç‰¹å®šçš„åº”ç”¨ï¼Œå®ç°å³æƒ³å³è¾¾ã€‚\n  æ¯”å¦‚æˆ‘ç”¨ Cmd+Ctrl+w å¯ä»¥è½»æ¾å”¤å‡ºå¾®ä¿¡ï¼ŒCmd+Ctrl+cæ‰“å¼€Chromeï¼ŒCmd+Ctrl+dæ‰“å¼€é’‰é’‰ï¼ŒCmd+Ctrl+tæ‰“å¼€ç»ˆç«¯iTerm2ç­‰ç­‰ã€‚\n\nå¤šè½¯ä»¶ä¸‹çš„è¾“å…¥æ³•ä¸ªæ€§åŒ–é…ç½®\n  ä¸€èˆ¬æˆ‘ä»¬ä¼šæ‰“å¼€å¾®ä¿¡ã€é’‰é’‰ç”¨ä¸­æ–‡è¿›è¡Œæ¶ˆæ¯å‘é€ï¼Œä½†åˆ‡æ¢åˆ°ç»ˆç«¯æ—¶æˆ‘ä»¬éœ€è¦ç”¨è‹±æ–‡è¿›è¡Œå‘½ä»¤è¡Œæˆ–è€…ç¼–ç¨‹ã€‚Hammerspoonå¯ä»¥æ”¯æŒæˆ‘ä»¬å¯¹ç‰¹å®šçš„åº”ç”¨è¿›è¡Œå¯¹åº”è¾“å…¥æ³•çš„é…ç½®ã€‚æ¯”å¦‚æˆ‘é…ç½®å¾®ä¿¡ã€é’‰é’‰æ— è®ºä½•æ—¶æ‰“å¼€éƒ½æ˜¯ä¸­æ–‡ï¼ŒåŒæ—¶ç»ˆç«¯ä¸€èˆ¬é»˜è®¤ç”¨è‹±æ–‡è¾“å…¥æ³•ã€‚\n\nå¤šå±ä¸‹çª—å£å¿«é€Ÿç§»åŠ¨å’Œé¼ æ ‡ç„¦ç‚¹åˆ‡æ¢åŠçª—å£å¸ƒå±€\n\né¼ æ ‡ç„¦ç‚¹å’Œå…‰æ ‡åˆ‡æ¢\nåœ¨ç¼–ç¨‹æˆ–è€…æŸ¥çœ‹èµ„æ–™çš„æ—¶å€™ï¼Œéœ€è¦ç»å¸¸åœ¨å¤šä¸ªå±å¹•ä¸­åˆ‡æ¢ã€‚æ‰€ä»¥æˆ‘å€ŸåŠ©Hammerspooné…ç½®äº†å¤šä¸ªå±å¹•ä¸‹åˆ‡æ¢å…‰æ ‡ç„¦ç‚¹çš„å¿«æ·é”®ã€‚\n\n\nè½¯ä»¶çª—å£åœ¨å¤šä¸ªå±å¹•é—´å¿«é€Ÿç§»åŠ¨\nåœ¨æ¼”ç¤ºåŠŸèƒ½ç”¨ä¾‹æˆ–è€…é¢„è§ˆèµ„æ–™çš„æ—¶å€™ï¼Œå¤§å±é¢„è§ˆä¼šæ¯”è¾ƒèˆ’æœå’Œæ–¹ä¾¿ã€‚å¿«æ·é”®å¯å®ç°å¿«é€Ÿç§»åŠ¨ï¼Œå¹¶ä¸”è‡ªåŠ¨æœ€å¤§åŒ–ï¼Œæ— éœ€ä½ é‡æ–°è°ƒæ•´çª—å£å¸ƒå±€ã€‚\n\n\nåŒå±å¹•å¤šè½¯ä»¶çª—å£å¸ƒå±€ã€‚\næ”¯æŒåŒå±å¹•æ‰“å¼€å¤šä¸ªçª—å£ï¼Œå¹¶è¿›è¡Œå„ç§æ¯”ä¾‹çš„å¸ƒå±€ã€‚å¸¸è§çš„æ˜¯å·¦å³å¸ƒå±€åŠä¸Šä¸‹å¸ƒå±€ã€‚\n\n\n\n\nè‡ªå®šä¹‰å¿«æ·é”®ï¼ŒæŸ¥çœ‹å½“å‰å¤©æ°”ã€å…¬å†å†œå†æ—¶é—´ã€‚\n\næœ‰æ—¶å€™æˆ‘ä»¬åœ¨æ²‰æµ¸å¼åœ°å…¨å±æ—¶ï¼Œæƒ³çœ‹å¤©æ°”æˆ–è€…å¾ˆå¤šèµ„æ–™ï¼ŒHammerspoonæ”¯æŒæˆ‘ä»¬è°ƒç”¨ç³»ç»Ÿå±•ç¤ºå±‚ï¼Œè¿›è¡Œç›¸åº”çš„ä¿¡æ¯å±•ç¤ºï¼Œéå¸¸æ–¹ä¾¿ã€‚å¦‚ä¸‹æ‰€ç¤ºã€‚\n\n  \n\n\nå¦‚ä½•å®‰è£…Hammerspoonï¼Ÿç‚¹å‡»Hammerspoonä¸‹è½½ï¼Œè§£å‹ä¹‹åï¼Œç›´æ¥æ‹–åˆ°åº”ç”¨è½¯ä»¶ç›®å½•ä¸‹å³å¯å®Œæˆå®‰è£…ã€‚\nå¦‚ä½•é…ç½®åŠåº”ç”¨Hammerspoonï¼Ÿ\næ–°å»ºHammerspooné…ç½®ç›®å½•\n  Hammerspoonéœ€è¦åœ¨å¦‚ä¸‹ç›®å½•ä¸‹è‡ªå®šä¹‰åˆ›å»ºé…ç½®æ–‡ä»¶ ~/.hammerspoon/init.lua ï¼Œå¦‚æœæ²¡æœ‰.hammerspoonç›®å½•ï¼Œåˆ™éœ€è¦æ–°å»ºã€‚\n\n\nç›®å½•ç»“æ„ä»‹ç»\n~/.hammerspoon â€”â€” é…ç½®æ–‡ä»¶ä¸»ç›®å½•\n\ninit.lua â€”â€” é…ç½®æ€»å…¥å£ï¼ŒåŠ è½½ç›¸å…³é…ç½®æ–‡ä»¶\nmodules â€”â€” å„æ¨¡å—ç›®å½•\nhotkey.lua  â€”â€” ç»„åˆå¿«æ·é”®å®šä¹‰\ninputsources.lua â€”â€” åº”ç”¨è½¯ä»¶è¾“å…¥æ³•å®ç°\nwindows.lua â€”â€” çª—å£å¸ƒå±€ã€ç§»åŠ¨ã€èšç„¦ç­‰å®ç°\n\n\n\nå®‰è£…åŠåŸºæœ¬é…ç½®ç›®å½•åˆ›å»ºå®Œæˆåï¼Œå°±å¯ä»¥è¿›è¡Œç¼–å†™ä»£ç å®ç°ä½ çš„ä¸ªæ€§åŒ–éœ€æ±‚äº†ã€‚\n\nå„é…ç½®æ–‡ä»¶é…ç½®\né¦–å…ˆæ˜¯å…¥å£æ–‡ä»¶init.luaï¼Œå¯å‚ç…§å¦‚ä¸‹é…ç½®ã€‚å…¥å£æ–‡ä»¶ä¸­å¼•ç”¨å…¶ä»–é…ç½®æ–‡ä»¶ï¼ŒåŒæ—¶æˆ‘é…ç½®äº†é‡æ–°åŠ è½½é…ç½®çš„åŠŸèƒ½ï¼Œæ–¹ä¾¿ä¿®æ”¹é…ç½®æ–‡ä»¶åå³æ—¶ç”Ÿæ•ˆã€‚\n\n\n\n-- Reload config automatically\nlocal configFileWatcher\nfunction reloadConfig()\n  configFileWatcher:stop()\n  configFileWatcher = nil\n  hs.reload()\nend\n\nconfigFileWatcher = hs.pathwatcher.new(os.getenv(&quot;HOME&quot;) .. &quot;/.hammerspoon/&quot;, reloadConfig)\nconfigFileWatcher:start()\n\n-- Load local modules\nrequire &quot;modules/hotkey&quot; -- hotkey.lua\nrequire &quot;modules/windows&quot; -- windows.lua\nrequire &quot;modules/inputsource&quot; -- inputsource.lua\n\n-- Load Spoons\n--\n\n-- Finally, show a notification that we finished loading the config\nhs.notify.new( &#123;title=&#39;Hammerspoon&#39;, subTitle=&#39;Configuration loaded&#39;&#125; ):send()\n\n- ç»„åˆå¿«æ·é”®å®šä¹‰modulesç›®å½•ä¸‹çš„hotkey.lua\n\nhyper = &#123;&quot;cmd&quot;, &quot;ctrl&quot;, &quot;alt&quot;&#125;\nhyperShift = &#123;&quot;alt&quot;, &quot;shift&quot;&#125;\nhyperCtrl = &#123;&quot;alt&quot;, &quot;ctrl&quot;&#125;\nhyperAlt = &#123;&quot;ctrl&quot;, &quot;alt&quot;, &quot;shift&quot;&#125;\n\n- ç„¶åæ˜¯modulesç›®å½•ä¸‹çš„inputsource.luaæ–‡ä»¶ï¼Œä¸ºå„åº”ç”¨è®¾ç½®å¯¹åº”çš„è¾“å…¥æ³•\n\nlocal application = require &quot;hs.application&quot;\nlocal hotkey = require &quot;hs.hotkey&quot;\nlocal window = require &quot;hs.window&quot;\nlocal alert = require &quot;hs.alert&quot;\nlocal keycodes = require &quot;hs.keycodes&quot;\nlocal function Chinese()\n    -- ç®€ä½“æ‹¼éŸ³\n    keycodes.currentSourceID(&quot;com.sogou.inputmethod.sogou.pinyin&quot;)\nend\n\nlocal function English()\n    -- ABC\n    keycodes.currentSourceID(&quot;com.apple.keylayout.ABC&quot;)\nend\n\n-- app to expected ime config\n-- appå’Œå¯¹åº”çš„è¾“å…¥æ³•\nlocal app2Ime = &#123;\n    &#123;&#39;/Applications/iTerm.app&#39;, &#39;English&#39;&#125;,\n    &#123;&#39;/System/Library/CoreServices/Finder.app&#39;, &#39;English&#39;&#125;,\n    &#123;&#39;/Applications/System Preferences.app&#39;, &#39;English&#39;&#125;,\n    &#123;&#39;/Applications/DingTalk.app&#39;, &#39;Chinese&#39;&#125;,\n    &#123;&#39;/Applications/WeChat.app&#39;, &#39;Chinese&#39;&#125;,\n    &#123;&#39;/Applications/Notion.app&#39;, &#39;Chinese&#39;&#125;,\n    -- &#123;&#39;/Applications/Google Chrome.app&#39;, &#39;English&#39;&#125;,\n    -- &#123;&#39;/Applications/Kindle.app&#39;, &#39;English&#39;&#125;,\n    -- &#123;&#39;/Applications/Visual Studio Code.app&#39;, &#39;English&#39;&#125;,\n    -- &#123;&#39;/Applications/Xcode.app&#39;, &#39;English&#39;&#125;,\n&#125;\n\nfunction updateFocusAppInputMethod()\n    local ime = &#39;English&#39;\n    local focusAppPath = window.frontmostWindow():application():path()\n    -- alert.show(&quot;path:  &quot;..focusAppPath )\n    for index, app in pairs(app2Ime) do\n        -- alert.show(&quot;app:  &quot;..app[1])\n        -- alert.show(&quot;im:  &quot;..app[2])\n        local appPath = app[1]\n        local expectedIme = app[2]\n\n        if focusAppPath == appPath then\n            ime = expectedIme\n            break\n        end\n    end\n\n    if ime == &#39;English&#39; then\n        English()\n    else\n        Chinese()\n    end\nend\n\n-- helper hotkey to figure out the app path and name of current focused window\n-- å½“é€‰ä¸­æŸçª—å£æŒ‰ä¸‹ctrl+command+mæ—¶ä¼šæ˜¾ç¤ºåº”ç”¨çš„è·¯å¾„ç­‰ä¿¡æ¯\nhotkey.bind(&#123;&#39;ctrl&#39;, &#39;cmd&#39;&#125;, &quot;m&quot;, function()\n    alert.show(&quot;App path is:        &quot;\n    ..window.focusedWindow():application():path()\n    ..&quot;\\n&quot;\n    ..&quot;App name:      &quot;\n    ..window.focusedWindow():application():name()\n    ..&quot;\\n&quot;\n    ..&quot;IM source id:  &quot;\n    ..keycodes.currentSourceID())\nend)\n\n-- Handle cursor focus and application&#39;s screen manage.\n-- çª—å£æ¿€æ´»æ—¶è‡ªåŠ¨åˆ‡æ¢è¾“å…¥æ³•\nfunction applicationWatcher(appName, eventType, appObject)\n    if (eventType == application.watcher.activated or eventType == application.watcher.launched) then\n        updateFocusAppInputMethod()\n    end\nend\n\nappWatcher = application.watcher.new(applicationWatcher)\nappWatcher:start()\n\n   - æœ€åæ˜¯modulesç›®å½•ä¸‹çš„windows.luaæ–‡ä»¶ï¼Œè¿›è¡Œçª—å£ã€å±å¹•ã€é¼ æ ‡çš„æ§åˆ¶ã€‚\n\n-- window management\nlocal application = require &quot;hs.application&quot;\nlocal hotkey = require &quot;hs.hotkey&quot;\nlocal window = require &quot;hs.window&quot;\nlocal layout = require &quot;hs.layout&quot;\nlocal grid = require &quot;hs.grid&quot;\nlocal hints = require &quot;hs.hints&quot;\nlocal screen = require &quot;hs.screen&quot;\nlocal alert = require &quot;hs.alert&quot;\nlocal fnutils = require &quot;hs.fnutils&quot;\nlocal geometry = require &quot;hs.geometry&quot;\nlocal mouse = require &quot;hs.mouse&quot;\n\n-- default 0.2\nwindow.animationDuration = 0\n-- alert.defaultStyle[&#39;fadeOutDuration&#39;] = 0.05\n\nfunction toggle_full()\n    local win = window.focusedWindow()\n    if win:isFullScreen() then\n        win:toggleFullScreen()\n    end\nend\n-- left half\nhotkey.bind(hyperCtrl, &quot;h&quot;, function()\n  if window.focusedWindow() then\n    window.focusedWindow():moveToUnit(layout.left50)\n  else\n    alert.show(&quot;No active window&quot;)\n  end\nend)\n\n-- right half\nhotkey.bind(hyperCtrl, &quot;l&quot;, function()\n  toggle_full()\n  window.focusedWindow():moveToUnit(layout.right50)\nend)\n\n-- top half\nhotkey.bind(hyperCtrl, &quot;k&quot;, function()\n  toggle_full()\n  window.focusedWindow():moveToUnit&#39;[0,0,100,50]&#39;\nend)\n\n-- bottom half\nhotkey.bind(hyperCtrl, &quot;j&quot;, function()\n  toggle_full()\n  window.focusedWindow():moveToUnit&#39;[0,50,100,100]&#39;\nend)\n\n-- full screen\nhotkey.bind(hyperCtrl, &#39;;&#39;, function() \n  window.focusedWindow():toggleFullScreen()\nend)\n\n-- center window\nhotkey.bind(hyperCtrl, &#39;c&#39;, function() \n  toggle_full()\n  window.focusedWindow():centerOnScreen()\nend)\n\n-- maximize window\nhotkey.bind(hyperCtrl, &#39;m&#39;, function()\n  toggle_full()\n  toggle_maximize()\nend)\n\n-- defines for window maximize toggler\nlocal frameCache = &#123;&#125;\n-- toggle a window between its normal size, and being maximized\nfunction toggle_maximize()\n    local win = window.focusedWindow()\n    win:maximize()\nend\n\n-- move active window to previous monitor\nhotkey.bind(hyper, &quot;h&quot;, function()\n  window.focusedWindow():moveOneScreenWest()\nend)\n\n-- move active window to next monitor\nhotkey.bind(hyper, &quot;l&quot;, function()\n  window.focusedWindow():moveOneScreenEast()\nend)\n\n-- open application using shortcut\nhotkey.bind(&#123;&#39;ctrl&#39;, &#39;cmd&#39;&#125;, &quot;c&quot;, function()\n  application.open(&#39;Google Chrome.app&#39;)\nend)\nhotkey.bind(&#123;&#39;ctrl&#39;, &#39;cmd&#39;&#125;, &quot;e&quot;, function()\n  application.open(&#39;Microsoft Edge.app&#39;)\nend)\nhotkey.bind(&#123;&#39;ctrl&#39;, &#39;cmd&#39;&#125;, &quot;t&quot;, function()\n  application.open(&#39;iTerm.app&#39;)\nend)\nhotkey.bind(&#123;&#39;ctrl&#39;, &#39;cmd&#39;&#125;, &quot;w&quot;, function()\n  application.open(&#39;WeChat.app&#39;)\nend)\nhotkey.bind(&#123;&#39;ctrl&#39;, &#39;cmd&#39;&#125;, &quot;d&quot;, function()\n  application.open(&#39;DingTalk.app&#39;)\nend)\nhotkey.bind(&#123;&#39;ctrl&#39;, &#39;cmd&#39;&#125;, &quot;n&quot;, function()\n  application.open(&#39;Notion.app&#39;)\nend)\n-- open Desktop Folder\nhotkey.bind(&#123;&#39;ctrl&#39;, &#39;cmd&#39;&#125;, &quot;f&quot;, function()\n  hs.execute(&#39;open /Users/Feng/Desktop/&#39;, true);\nend)\n\n--Predicate that checks if a window belongs to a screen\nfunction isInScreen(screen, win)\n  return win:screen() == screen\nend\n\nfunction focusScreen(screen)\n  --Get windows within screen, ordered from front to back.\n  --If no windows exist, bring focus to desktop. Otherwise, set focus on\n  --front-most application window.\n  local windows = fnutils.filter(\n      window.orderedWindows(),\n      fnutils.partial(isInScreen, screen))\n  local windowToFocus = #windows &gt; 0 and windows[1] or window.desktop()\n  windowToFocus:focus()\n\n  -- move cursor to center of screen\n  local pt = geometry.rectMidPoint(screen:fullFrame())\n  mouse.setAbsolutePosition(pt)\nend\n\n-- maximized active window and move to selected monitor\nlocal moveto = function(win, n)\n  local screens = screen.allScreens()\n  if n &gt; #screens then\n    alert.show(&quot;Only &quot; .. #screens .. &quot; monitors &quot;)\n  else\n    local toWin = screen.allScreens()[n]:name()\n    -- alert.show(&quot;Move &quot; .. win:application():name() .. &quot; to &quot; .. toWin)\n    layout.apply(&#123;&#123;nil, win:title(), toWin, layout.maximized, nil, nil&#125;&#125;)\n    -- window.focusedWindow():toggleFullScreen()\n  end end\n\n//move cursor in different screens\nhotkey.bind(hyperShift, &quot;1&quot;, function()\n  -- local win = window.focusedWindow()\n  -- moveto(win, 1)\n  focusScreen(screen.allScreens()[1])\n  alert.show(&quot;Mac-1&quot;, 1)\n  -- alert.show(&quot;Cursor is on the &quot; .. screen.allScreens()[1]:fullFrame().. &quot; monitors &quot;)\n\nend)\n\nhotkey.bind(hyperShift, &quot;2&quot;, function()\n  focusScreen(screen.allScreens()[3])\n  alert.show(&quot;Redmi-2&quot;, 1)\nend)\n\nhotkey.bind(hyperShift, &quot;3&quot;, function()\n  focusScreen(screen.allScreens()[2])\n  alert.show(&quot;Dell-3&quot;, 1)\nend)\n\næ€»ç»“ä»¥ä¸Šå°±æ˜¯Hammerspoonçš„æ•´ä½“ä»‹ç»äº†ï¼Œå¸Œæœ›çœ‹åˆ°è¿™ç¯‡æ–‡ç« çš„ä½ èƒ½æœ‰æ”¶è·~\n","slug":"article-title","date":"2023-07-28T07:09:03.000Z","categories_index":"","tags_index":"","author_index":"Feng"},{"id":"b9663f58f18133b35bfe243f3e916a80","title":"Hello World","content":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.\nQuick StartCreate a new post$ hexo new &quot;My New Post&quot;\n\nMore info: Writing\nRun server$ hexo server\n\nMore info: Server\nGenerate static files$ hexo generate\n\nMore info: Generating\nDeploy to remote sites$ hexo deploy\n\nMore info: Deployment\n","slug":"hello-world","date":"2023-07-28T03:59:37.942Z","categories_index":"","tags_index":"","author_index":"Feng"}]